/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={742:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,i=u(e),o=i[0],a=i[1],c=new s(function(e,t,r){return 3*(t+r)/4-r}(0,o,a)),l=0,d=a>0?o-4:o;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[l++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,s=n%3,i=[],o=16383,a=0,u=n-s;a<u;a+=o)i.push(c(e,a,a+o>u?u:a+o));return 1===s?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===s&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=i.length;o<a;++o)r[o]=i[o],n[i.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,n){for(var s,i,o=[],a=t;a<n;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(i=s)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},764:(e,t,r)=>{"use strict";var n=r(742),s=r(645),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.lW=u,t.h2=50;var o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return c(e,t,r)}function c(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|_(e,t),n=a(r),s=n.write(e,t);return s!==r&&(n=n.slice(0,s)),n}(e,t);if(ArrayBuffer.isView(e))return f(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(q(e,ArrayBuffer)||e&&q(e.buffer,ArrayBuffer))return E(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(q(e,SharedArrayBuffer)||e&&q(e.buffer,SharedArrayBuffer)))return E(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);var s=function(e){if(u.isBuffer(e)){var t=0|h(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||Y(e.length)?a(0):f(e):"Buffer"===e.type&&Array.isArray(e.data)?f(e.data):void 0}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return l(e),a(e<0?0:0|h(e))}function f(e){for(var t=e.length<0?0:0|h(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function E(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,u.prototype),n}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function _(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||q(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var s=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return D(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(s)return n?-1:D(e).length;t=(""+t).toLowerCase(),s=!0}}function p(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return v(this,t,r);case"utf8":case"utf-8":return O(this,t,r);case"ascii":return N(this,t,r);case"latin1":case"binary":return w(this,t,r);case"base64":return M(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function b(e,t,r,n,s){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Y(r=+r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:S(e,t,r,n,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):S(e,[t],r,n,s);throw new TypeError("val must be string, number or Buffer")}function S(e,t,r,n,s){var i,o=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,u/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){var l=-1;for(i=r;i<a;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*o}else-1!==l&&(i-=i-l),l=-1}else for(r+u>a&&(r=a-u),i=r;i>=0;i--){for(var d=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){d=!1;break}if(d)return i}return-1}function g(e,t,r,n){r=Number(r)||0;var s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;var i=t.length;n>i/2&&(n=i/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(Y(a))return o;e[r+o]=a}return o}function A(e,t,r,n){return j(D(t,e.length-r),e,r,n)}function T(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function y(e,t,r,n){return T(e,t,r,n)}function R(e,t,r,n){return j(G(t),e,r,n)}function I(e,t,r,n){return j(function(e,t){for(var r,n,s,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,s=r%256,i.push(s),i.push(n);return i}(t,e.length-r),e,r,n)}function M(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function O(e,t,r){r=Math.min(e.length,r);for(var n=[],s=t;s<r;){var i,o,a,u,c=e[s],l=null,d=c>239?4:c>223?3:c>191?2:1;if(s+d<=r)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(i=e[s+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[s+1],o=e[s+2],128==(192&i)&&128==(192&o)&&(u=(15&c)<<12|(63&i)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[s+1],o=e[s+2],a=e[s+3],128==(192&i)&&128==(192&o)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),s+=d}return function(e){var t=e.length;if(t<=P)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=P));return r}(n)}u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,r){return c(e,t,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},u.allocUnsafe=function(e){return d(e)},u.allocUnsafeSlow=function(e){return d(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),q(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,s=0,i=Math.min(r,n);s<i;++s)if(e[s]!==t[s]){r=e[s],n=t[s];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),s=0;for(r=0;r<e.length;++r){var i=e[r];if(q(i,Uint8Array)&&(i=u.from(i)),!u.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,s),s+=i.length}return n},u.byteLength=_,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?O(this,0,e):p.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.h2;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},i&&(u.prototype[i]=u.prototype.inspect),u.prototype.compare=function(e,t,r,n,s){if(q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||r>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=r)return 0;if(n>=s)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(s>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(i,o),c=this.slice(n,s),l=e.slice(t,r),d=0;d<a;++d)if(c[d]!==l[d]){i=c[d],o=l[d];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var s=this.length-t;if((void 0===r||r>s)&&(r=s),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return A(this,e,t,r);case"ascii":return T(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return R(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;function N(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(127&e[s]);return n}function w(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}function v(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var s="",i=t;i<r;++i)s+=z[e[i]];return s}function C(e,t,r){for(var n=e.slice(t,r),s="",i=0;i<n.length;i+=2)s+=String.fromCharCode(n[i]+256*n[i+1]);return s}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function F(e,t,r,n,s,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function U(e,t,r,n,s,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,n,i){return t=+t,r>>>=0,i||U(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function k(e,t,r,n,i){return t=+t,r>>>=0,i||U(e,0,r,8),s.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n},u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e+--t],s=1;t>0&&(s*=256);)n+=this[e+--t]*s;return n},u.prototype.readUInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=t,s=1,i=this[e+--n];n>0&&(s*=256);)i+=this[e+--n]*s;return i>=(s*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||L(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||L(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||L(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||L(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||F(this,e,t,r,Math.pow(2,8*r)-1,0);var s=1,i=0;for(this[t]=255&e;++i<r&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||F(this,e,t,r,Math.pow(2,8*r)-1,0);var s=r-1,i=1;for(this[t+s]=255&e;--s>=0&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var s=Math.pow(2,8*r-1);F(this,e,t,r,s-1,-s)}var i=0,o=1,a=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var s=Math.pow(2,8*r-1);F(this,e,t,r,s-1,-s)}var i=r-1,o=1,a=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||F(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return k(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return k(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var s=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=s-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return s},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var o=u.isBuffer(e)?e:u.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%a]}return this};var x=/[^+/0-9A-Za-z-_]/g;function D(e,t){var r;t=t||1/0;for(var n=e.length,s=null,i=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function G(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,n){for(var s=0;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}function q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}var z=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,s=0;s<16;++s)t[n+s]=e[r]+e[s];return t}()},139:e=>{"use strict";function t(e){return function(){return e}}var r=function(){};r.thatReturns=t,r.thatReturnsFalse=t(!1),r.thatReturnsTrue=t(!0),r.thatReturnsNull=t(null),r.thatReturnsThis=function(){return this},r.thatReturnsArgument=function(e){return e},e.exports=r},614:e=>{"use strict";var t=Object.prototype.hasOwnProperty;e.exports=function(e,r,n){for(var s in e)t.call(e,s)&&r.call(n,e[s],s,e)}},759:e=>{"use strict";var t=function(e){if(void 0===e)throw new Error("invariant(...): Second argument must be a string.")};e.exports=function(e,r){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];if(t(r),!e){var o;if(void 0===r)o=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=0;(o=new Error(r.replace(/%s/g,(function(){return String(s[a++])})))).name="Invariant Violation"}throw o.framesToPop=1,o}}},45:e=>{"use strict";e.exports=function(e){if(null!=e)return e;throw new Error("Got unexpected null or undefined")}},857:e=>{"use strict";e.exports=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s=0;return e.replace(/%s/g,(function(e){return r[s++]}))}},620:(e,t,r)=>{"use strict";var n=r(139);e.exports=n},645:(e,t)=>{t.read=function(e,t,r,n,s){var i,o,a=8*s-n-1,u=(1<<a)-1,c=u>>1,l=-7,d=r?s-1:0,f=r?-1:1,E=e[t+d];for(d+=f,i=E&(1<<-l)-1,E>>=-l,l+=a;l>0;i=256*i+e[t+d],d+=f,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=n;l>0;o=256*o+e[t+d],d+=f,l-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(E?-1:1);o+=Math.pow(2,n),i-=c}return(E?-1:1)*o*Math.pow(2,i-n)},t.write=function(e,t,r,n,s,i){var o,a,u,c=8*i-s-1,l=(1<<c)-1,d=l>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,E=n?0:i-1,h=n?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=l?(a=0,o=l):o+d>=1?(a=(t*u-1)*Math.pow(2,s),o+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,s),o=0));s>=8;e[r+E]=255&a,E+=h,a/=256,s-=8);for(o=o<<s|a,c+=s;c>0;e[r+E]=255&o,E+=h,o/=256,c-=8);e[r+E-h]|=128*_}},145:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WellKnownMimeTypeEntry=t.ReservedMimeTypeEntry=t.ExplicitMimeTimeEntry=t.CompositeMetadata=void 0,t.encodeAndAddCustomMetadata=function(e,t,r){return s.LiteBuffer.concat([e,d(t,r.byteLength),r])},t.encodeAndAddWellKnownMetadata=function(e,t,r){let n;return n=Number.isInteger(t)?t:t.identifier,s.LiteBuffer.concat([e,f(n,r.byteLength),r])},t.decodeMimeAndContentBuffersSlices=c,t.decodeMimeTypeFromMimeBuffer=l,t.encodeCustomMetadataHeader=d,t.encodeWellKnownMetadataHeader=f;var n,s=r(771),i=r(502),o=r(369),a=(n=o)&&n.__esModule?n:{default:n};class u{constructor(e){this._buffer=e}[Symbol.iterator](){return function*(e){const t=e.byteLength;let r=0;for(;r<t;){const t=c(e,r),i=t[0],u=t[1];if(s=u,r=r+i.byteLength+3+s.byteLength,!p(i)){const e=l(i);if(!e)throw new Error("MIME type cannot be null");yield new E(u,e);continue}const d=p(n=i)?n.readInt8()&b:o.UNPARSEABLE_MIME_TYPE.identifier,f=a.default.fromIdentifier(d);o.UNKNOWN_RESERVED_MIME_TYPE!==f?yield new _(u,f):yield new h(u,d)}var n,s}(this._buffer)}}function c(e,t){const r=e.readInt8(t,1);let n,s=t;if((r&m)===m)n=e.slice(s,s+1),s+=1;else{const t=1+(255&r);if(!(e.byteLength>s+t))throw new Error("Metadata is malformed. Inappropriately formed Mime Length");n=e.slice(s,s+t+1),s+=t+1}if(e.byteLength>=s+3){const t=(0,i.readUInt24BE)(e,s);if(s+=3,e.byteLength>=t+s)return[n,e.slice(s,s+t)];throw new Error("Metadata is malformed. Inappropriately formed Metadata Length or malformed content")}throw new Error("Metadata is malformed. Metadata Length is absent or malformed")}function l(e){if(e.length<2)throw new Error("Unable to decode explicit MIME type");return e.toString("ascii",1)}function d(e,t){const r=(0,i.createBuffer)(4+e.length),n=r.write(e,1);if(!function(e,t){let r=!0;for(let t=1,n=e.length;t<n;t++)if(e[t]>127){r=!1;break}return r}(r))throw new Error("Custom mime type must be US_ASCII characters only");if(n<1||n>128)throw new Error("Custom mime type must have a strictly positive length that fits on 7 unsigned bits, ie 1-128");return r.writeUInt8(n-1),(0,i.writeUInt24BE)(r,t,n+1),r}function f(e,t){const r=s.LiteBuffer.alloc(4);return r.writeUInt8(e|m),(0,i.writeUInt24BE)(r,t,1),r}t.CompositeMetadata=u;class E{constructor(e,t){this._content=e,this._type=t}get content(){return this._content}get mimeType(){return this._type}}t.ExplicitMimeTimeEntry=E;class h{constructor(e,t){this._content=e,this._type=t}get content(){return this._content}get mimeType(){}get type(){return this._type}}t.ReservedMimeTypeEntry=h;class _{constructor(e,t){this._content=e,this._type=t}get content(){return this._content}get mimeType(){return this._type.string}get type(){return this._type}}function p(e){return 1===e.byteLength}t.WellKnownMimeTypeEntry=_;const m=128,b=127},771:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=o;const n=2147483647;function s(e){if(e>n)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return t.__proto__=o.prototype,t}const i=void 0!==r.g&&r.g.hasOwnProperty("Buffer");function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(n=e),s(n<0?0:0|l(n))}var n;return a(e,t,r)}function a(e,t,r){if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(p(e,ArrayBuffer)||e&&p(e.buffer,ArrayBuffer))return function(e,t,r){let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),n.__proto__=o.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);const i=function(e){if(o.isBuffer(e)){const t=0|l(e.length),r=s(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?s(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(i)return i;throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){const t=e.length<0?0:0|l(e.length),r=s(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function l(e){if(e>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function d(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function f(e,t,r,n,s,i){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function E(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"utf8":case"utf-8":return _(this,t,r);default:if(n)throw new TypeError("Unsupported encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function h(e,t=1/0){let r,n=t;const s=e.length;let i=null;const o=[];for(let t=0;t<s;++t){if(r=e.charCodeAt(t),r>55295&&r<57344){if(!i){if(r>56319){(n-=3)>-1&&o.push(239,191,189);continue}if(t+1===s){(n-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(n-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(n-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((n-=1)<0)break;o.push(r)}else if(r<2048){if((n-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((n-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((n-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function _(e,t,r){r=Math.min(e.length,r);const n=[];let s=t;for(;s<r;){const t=e[s];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(s+o<=r){let r,n,a,u;switch(o){case 1:t<128&&(i=t);break;case 2:r=e[s+1],128==(192&r)&&(u=(31&t)<<6|63&r,u>127&&(i=u));break;case 3:r=e[s+1],n=e[s+2],128==(192&r)&&128==(192&n)&&(u=(15&t)<<12|(63&r)<<6|63&n,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:r=e[s+1],n=e[s+2],a=e[s+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(u=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,u>65535&&u<1114112&&(i=u))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),s+=o}return function(e){const t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}function p(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}t.LiteBuffer=i?r.g.Buffer:o,o.from=function(e,t,r){return a(e,t,r)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(e,t,r){return function(e,t,r){return u(e),s(e)}(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=o.alloc(t);let s=0;for(r=0;r<e.length;++r){let t=e[r];if(p(t,Uint8Array)&&(t=o.from(t)),!o.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,s),s+=t.length}return n},o.prototype._isBuffer=!0,o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,void 0===r?(n="utf8",r=this.length):isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=this.length)}switch(n){case"utf8":return function(e,t,r,n){return function(e,t,r,n){let s=0;for(;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}(h(t,e.length-r),e,r,n)}(this,e,t,r);default:throw new TypeError("Unknown encoding: "+n)}},o.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return n.__proto__=o.prototype,n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||d(e,1,this.length),this[e]},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||d(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||d(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readInt8=function(e,t){return e>>>=0,t||d(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16BE=function(e,t){e>>>=0,t||d(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||d(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||f(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||f(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||f(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||f(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||f(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.toString=function(){const e=this.length;return 0===e?"":E.apply(this,arguments)},o.byteLength=function(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||p(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let s=!1;for(;;)switch(t){case"utf8":case"utf-8":return h(e).length;default:if(s)return n?-1:h(e).length;t=(""+t).toLowerCase(),s=!0}throw new Error("Unexpected path in function")},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const s=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(let n=s-1;n>=0;--n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return s}},776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeFrameWithLength=function(e,t){const r=(0,a.readUInt24BE)(e,0);return u(e.slice(3,3+r),t)},t.deserializeFrames=function(e,t){const r=[];let n=0;for(;n+3<e.length;){const s=n+3,i=s+(0,a.readUInt24BE)(e,n);if(i>e.length)break;const o=u(e.slice(s,i),t);r.push(o),n=i}return[r,e.slice(n,e.length)]},t.serializeFrameWithLength=function(e,t){const r=c(e,t),n=(0,a.createBuffer)(r.length+3);return(0,a.writeUInt24BE)(n,r.length,0),r.copy(n,3,0,r.length),n},t.deserializeFrame=u,t.serializeFrame=c,t.sizeOfFrame=function(e,t){switch(t=t||o.Utf8Encoders,e.type){case i.FRAME_TYPES.SETUP:return function(e,t){const r=null!=e.resumeToken?t.resumeToken.byteLength(e.resumeToken):0;return 20+(r?2+r:0)+(null!=e.metadataMimeType?t.metadataMimeType.byteLength(e.metadataMimeType):0)+(null!=e.dataMimeType?t.dataMimeType.byteLength(e.dataMimeType):0)+d(e,t)}(e,t);case i.FRAME_TYPES.PAYLOAD:return function(e,t){return 6+d(e,t)}(e,t);case i.FRAME_TYPES.ERROR:return function(e,t){return 10+(null!=e.message?t.message.byteLength(e.message):0)}(e,t);case i.FRAME_TYPES.KEEPALIVE:return function(e,t){return 14+(null!=e.data?t.data.byteLength(e.data):0)}(e,t);case i.FRAME_TYPES.REQUEST_FNF:case i.FRAME_TYPES.REQUEST_RESPONSE:return function(e,t){return 6+d(e,t)}(e,t);case i.FRAME_TYPES.REQUEST_STREAM:case i.FRAME_TYPES.REQUEST_CHANNEL:return function(e,t){return 10+d(e,t)}(e,t);case i.FRAME_TYPES.REQUEST_N:return 10;case i.FRAME_TYPES.RESUME:return function(e,t){return 28+t.resumeToken.byteLength(e.resumeToken)}(e,t);case i.FRAME_TYPES.RESUME_OK:return 14;case i.FRAME_TYPES.CANCEL:return 6;case i.FRAME_TYPES.LEASE:return function(e,t){return 14+(null!=e.metadata?t.metadata.byteLength(e.metadata):0)}(e,t);default:(0,s.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,i.getFrameTypeName)(e.type))}};var n,s=(n=r(759))&&n.__esModule?n:{default:n},i=r(148),o=r(882),a=r(502);function u(e,t){t=t||o.Utf8Encoders;let r=0;const n=e.readInt32BE(r);r+=4,(0,s.default)(n>=0,"RSocketBinaryFraming: Invalid frame, expected a positive stream id, got `%s.",n);const u=e.readUInt16BE(r);r+=2;const c=u>>>i.FRAME_TYPE_OFFFSET,l=u&i.FLAGS_MASK;switch(c){case i.FRAME_TYPES.SETUP:return function(e,t,r,n){(0,s.default)(0===t,"RSocketBinaryFraming: Invalid SETUP frame, expected stream id to be 0.");const o=e.length;let a=6;const u=e.readUInt16BE(a);a+=2;const c=e.readUInt16BE(a);a+=2;const l=e.readInt32BE(a);a+=4,(0,s.default)(l>=0&&l<=i.MAX_KEEPALIVE,"RSocketBinaryFraming: Invalid SETUP frame, expected keepAlive to be >= 0 and <= %s. Got `%s`.",i.MAX_KEEPALIVE,l);const d=e.readInt32BE(a);a+=4,(0,s.default)(d>=0&&d<=i.MAX_LIFETIME,"RSocketBinaryFraming: Invalid SETUP frame, expected lifetime to be >= 0 and <= %s. Got `%s`.",i.MAX_LIFETIME,d);let f=null;if(r&i.FLAGS.RESUME_ENABLE){const t=e.readInt16BE(a);a+=2,(0,s.default)(t>=0&&t<=i.MAX_RESUME_LENGTH,"RSocketBinaryFraming: Invalid SETUP frame, expected resumeToken length to be >= 0 and <= %s. Got `%s`.",i.MAX_RESUME_LENGTH,t),f=n.resumeToken.decode(e,a,a+t),a+=t}const h=e.readUInt8(a);a+=1;const _=n.metadataMimeType.decode(e,a,a+h);a+=h;const p=e.readUInt8(a);a+=1;const m=n.dataMimeType.decode(e,a,a+p);a+=p;const b={data:null,dataMimeType:m,flags:r,keepAlive:l,length:o,lifetime:d,majorVersion:u,metadata:null,metadataMimeType:_,minorVersion:c,resumeToken:f,streamId:t,type:i.FRAME_TYPES.SETUP};return E(e,b,n,a),b}(e,n,l,t);case i.FRAME_TYPES.PAYLOAD:return function(e,t,r,n){(0,s.default)(t>0,"RSocketBinaryFraming: Invalid PAYLOAD frame, expected stream id to be > 0.");const o={data:null,flags:r,length:e.length,metadata:null,streamId:t,type:i.FRAME_TYPES.PAYLOAD};return E(e,o,n,6),o}(e,n,l,t);case i.FRAME_TYPES.ERROR:return function(e,t,r,n){const o=e.length;let a=6;const u=e.readInt32BE(a);a+=4,(0,s.default)(u>=0&&u<=i.MAX_CODE,"RSocketBinaryFraming: Invalid ERROR frame, expected code to be >= 0 and <= %s. Got `%s`.",i.MAX_CODE,u);const c=e.length-a;let l="";return c>0&&(l=n.message.decode(e,a,a+c),a+=c),{code:u,flags:r,length:o,message:l,streamId:t,type:i.FRAME_TYPES.ERROR}}(e,n,l,t);case i.FRAME_TYPES.KEEPALIVE:return function(e,t,r,n){(0,s.default)(0===t,"RSocketBinaryFraming: Invalid KEEPALIVE frame, expected stream id to be 0.");const o=e.length;let u=6;const c=(0,a.readUInt64BE)(e,u);u+=8;let l=null;return u<e.length&&(l=n.data.decode(e,u,e.length)),{data:l,flags:r,lastReceivedPosition:c,length:o,streamId:t,type:i.FRAME_TYPES.KEEPALIVE}}(e,n,l,t);case i.FRAME_TYPES.REQUEST_FNF:return function(e,t,r,n){(0,s.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_FNF frame, expected stream id to be > 0.");const o={data:null,flags:r,length:e.length,metadata:null,streamId:t,type:i.FRAME_TYPES.REQUEST_FNF};return E(e,o,n,6),o}(e,n,l,t);case i.FRAME_TYPES.REQUEST_RESPONSE:return function(e,t,r,n){(0,s.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_RESPONSE frame, expected stream id to be > 0.");const o={data:null,flags:r,length:e.length,metadata:null,streamId:t,type:i.FRAME_TYPES.REQUEST_RESPONSE};return E(e,o,n,6),o}(e,n,l,t);case i.FRAME_TYPES.REQUEST_STREAM:return function(e,t,r,n){(0,s.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected stream id to be > 0.");const o=e.length;let a=6;const u=e.readInt32BE(a);a+=4,(0,s.default)(u>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",u);const c={data:null,flags:r,length:o,metadata:null,requestN:u,streamId:t,type:i.FRAME_TYPES.REQUEST_STREAM};return E(e,c,n,a),c}(e,n,l,t);case i.FRAME_TYPES.REQUEST_CHANNEL:return function(e,t,r,n){(0,s.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_CHANNEL frame, expected stream id to be > 0.");const o=e.length;let a=6;const u=e.readInt32BE(a);a+=4,(0,s.default)(u>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",u);const c={data:null,flags:r,length:o,metadata:null,requestN:u,streamId:t,type:i.FRAME_TYPES.REQUEST_CHANNEL};return E(e,c,n,a),c}(e,n,l,t);case i.FRAME_TYPES.REQUEST_N:return function(e,t,r,n){(0,s.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_N frame, expected stream id to be > 0.");const o=e.length,a=e.readInt32BE(6);return(0,s.default)(a>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",a),{flags:r,length:o,requestN:a,streamId:t,type:i.FRAME_TYPES.REQUEST_N}}(e,n,l);case i.FRAME_TYPES.RESUME:return function(e,t,r,n){(0,s.default)(0===t,"RSocketBinaryFraming: Invalid RESUME frame, expected stream id to be 0.");const o=e.length;let u=6;const c=e.readUInt16BE(u);u+=2;const l=e.readUInt16BE(u);u+=2;const d=e.readInt16BE(u);u+=2,(0,s.default)(d>=0&&d<=i.MAX_RESUME_LENGTH,"RSocketBinaryFraming: Invalid SETUP frame, expected resumeToken length to be >= 0 and <= %s. Got `%s`.",i.MAX_RESUME_LENGTH,d);const f=n.resumeToken.decode(e,u,u+d);u+=d;const E=(0,a.readUInt64BE)(e,u);u+=8;const h=(0,a.readUInt64BE)(e,u);return u+=8,{clientPosition:h,flags:r,length:o,majorVersion:c,minorVersion:l,resumeToken:f,serverPosition:E,streamId:t,type:i.FRAME_TYPES.RESUME}}(e,n,l,t);case i.FRAME_TYPES.RESUME_OK:return function(e,t,r,n){(0,s.default)(0===t,"RSocketBinaryFraming: Invalid RESUME frame, expected stream id to be 0.");const o=e.length;return{clientPosition:(0,a.readUInt64BE)(e,6),flags:r,length:o,streamId:t,type:i.FRAME_TYPES.RESUME_OK}}(e,n,l);case i.FRAME_TYPES.CANCEL:return function(e,t,r,n){(0,s.default)(t>0,"RSocketBinaryFraming: Invalid CANCEL frame, expected stream id to be > 0.");return{flags:r,length:e.length,streamId:t,type:i.FRAME_TYPES.CANCEL}}(e,n,l);case i.FRAME_TYPES.LEASE:return function(e,t,r,n){(0,s.default)(0===t,"RSocketBinaryFraming: Invalid LEASE frame, expected stream id to be 0.");const o=e.length;let a=6;const u=e.readUInt32BE(a);a+=4;const c=e.readUInt32BE(a);a+=4;let l=null;return a<e.length&&(l=n.metadata.decode(e,a,e.length)),{flags:r,length:o,metadata:l,requestCount:c,streamId:t,ttl:u,type:i.FRAME_TYPES.LEASE}}(e,n,l,t);default:(0,s.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,i.getFrameTypeName)(c))}}function c(e,t){switch(t=t||o.Utf8Encoders,e.type){case i.FRAME_TYPES.SETUP:return function(e,t){const r=null!=e.resumeToken?t.resumeToken.byteLength(e.resumeToken):0,n=null!=e.metadataMimeType?t.metadataMimeType.byteLength(e.metadataMimeType):0,s=null!=e.dataMimeType?t.dataMimeType.byteLength(e.dataMimeType):0,o=d(e,t),u=(0,a.createBuffer)(20+(r?2+r:0)+n+s+o);let c=l(e,u);return c=u.writeUInt16BE(e.majorVersion,c),c=u.writeUInt16BE(e.minorVersion,c),c=u.writeUInt32BE(e.keepAlive,c),c=u.writeUInt32BE(e.lifetime,c),e.flags&i.FLAGS.RESUME_ENABLE&&(c=u.writeUInt16BE(r,c),null!=e.resumeToken&&(c=t.resumeToken.encode(e.resumeToken,u,c,c+r))),c=u.writeUInt8(n,c),null!=e.metadataMimeType&&(c=t.metadataMimeType.encode(e.metadataMimeType,u,c,c+n)),c=u.writeUInt8(s,c),null!=e.dataMimeType&&(c=t.dataMimeType.encode(e.dataMimeType,u,c,c+s)),f(e,u,t,c),u}(e,t);case i.FRAME_TYPES.PAYLOAD:return function(e,t){const r=d(e,t),n=(0,a.createBuffer)(6+r);return f(e,n,t,l(e,n)),n}(e,t);case i.FRAME_TYPES.ERROR:return function(e,t){const r=null!=e.message?t.message.byteLength(e.message):0,n=(0,a.createBuffer)(10+r);let s=l(e,n);return s=n.writeUInt32BE(e.code,s),null!=e.message&&t.message.encode(e.message,n,s,s+r),n}(e,t);case i.FRAME_TYPES.KEEPALIVE:return function(e,t){const r=null!=e.data?t.data.byteLength(e.data):0,n=(0,a.createBuffer)(14+r);let s=l(e,n);return s=(0,a.writeUInt64BE)(n,e.lastReceivedPosition,s),null!=e.data&&t.data.encode(e.data,n,s,s+r),n}(e,t);case i.FRAME_TYPES.REQUEST_FNF:case i.FRAME_TYPES.REQUEST_RESPONSE:return function(e,t){const r=d(e,t),n=(0,a.createBuffer)(6+r);return f(e,n,t,l(e,n)),n}(e,t);case i.FRAME_TYPES.REQUEST_STREAM:case i.FRAME_TYPES.REQUEST_CHANNEL:return function(e,t){const r=d(e,t),n=(0,a.createBuffer)(10+r);let s=l(e,n);return s=n.writeUInt32BE(e.requestN,s),f(e,n,t,s),n}(e,t);case i.FRAME_TYPES.REQUEST_N:return function(e,t){const r=(0,a.createBuffer)(10),n=l(e,r);return r.writeUInt32BE(e.requestN,n),r}(e);case i.FRAME_TYPES.RESUME:return function(e,t){const r=t.resumeToken.byteLength(e.resumeToken),n=(0,a.createBuffer)(28+r);let s=l(e,n);return s=n.writeUInt16BE(e.majorVersion,s),s=n.writeUInt16BE(e.minorVersion,s),s=n.writeUInt16BE(r,s),s=t.resumeToken.encode(e.resumeToken,n,s,s+r),s=(0,a.writeUInt64BE)(n,e.serverPosition,s),(0,a.writeUInt64BE)(n,e.clientPosition,s),n}(e,t);case i.FRAME_TYPES.RESUME_OK:return function(e,t){const r=(0,a.createBuffer)(14),n=l(e,r);return(0,a.writeUInt64BE)(r,e.clientPosition,n),r}(e);case i.FRAME_TYPES.CANCEL:return function(e,t){const r=(0,a.createBuffer)(6);return l(e,r),r}(e);case i.FRAME_TYPES.LEASE:return function(e,t){const r=null!=e.metadata?t.metadata.byteLength(e.metadata):0,n=(0,a.createBuffer)(14+r);let s=l(e,n);return s=n.writeUInt32BE(e.ttl,s),s=n.writeUInt32BE(e.requestCount,s),null!=e.metadata&&t.metadata.encode(e.metadata,n,s,s+r),n}(e,t);default:(0,s.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,i.getFrameTypeName)(e.type))}}function l(e,t){const r=t.writeInt32BE(e.streamId,0);return t.writeUInt16BE(e.type<<i.FRAME_TYPE_OFFFSET|e.flags&i.FLAGS_MASK,r)}function d(e,t){let r=0;return null!=e.data&&(r+=t.data.byteLength(e.data)),(0,i.isMetadata)(e.flags)&&(r+=3,null!=e.metadata&&(r+=t.metadata.byteLength(e.metadata))),r}function f(e,t,r,n){if((0,i.isMetadata)(e.flags))if(null!=e.metadata){const s=r.metadata.byteLength(e.metadata);n=(0,a.writeUInt24BE)(t,s,n),n=r.metadata.encode(e.metadata,t,n,n+s)}else n=(0,a.writeUInt24BE)(t,0,n);null!=e.data&&r.data.encode(e.data,t,n,t.length)}function E(e,t,r,n){if((0,i.isMetadata)(t.flags)){const s=(0,a.readUInt24BE)(e,n);n+=3,s>0&&(t.metadata=r.metadata.decode(e,n,n+s),n+=s)}n<e.length&&(t.data=r.data.decode(e,n,e.length))}},502:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBuffer=void 0,t.readUInt24BE=function(e,t){return e.readUInt8(t)<<16|e.readUInt8(t+1)<<8|e.readUInt8(t+2)},t.writeUInt24BE=function(e,t,r){return r=e.writeUInt8(t>>>16,r),r=e.writeUInt8(t>>>8&255,r),e.writeUInt8(255&t,r)},t.readUInt64BE=function(e,t){const r=e.readUInt32BE(t),n=e.readUInt32BE(t+4);return r*o+n},t.writeUInt64BE=function(e,t,r){const n=t/o|0,s=t%o;return r=e.writeUInt32BE(n,r),e.writeUInt32BE(s,r)},t.byteLength=function(e,t){return null==e?0:s.LiteBuffer.byteLength(e,t)},t.toBuffer=function(e){return e instanceof s.LiteBuffer?e:((0,i.default)(e instanceof ArrayBuffer,"RSocketBufferUtils: Cannot construct buffer. Expected data to be an arraybuffer, got `%s`.",e),s.LiteBuffer.from(e))};var n,s=r(771),i=(n=r(759))&&n.__esModule?n:{default:n};const o=4294967296;t.createBuffer="function"==typeof s.LiteBuffer.alloc?e=>s.LiteBuffer.alloc(e):e=>new s.LiteBuffer(e).fill(0)},694:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(956),i=(n=r(759))&&n.__esModule?n:{default:n},o=r(148),a=r(605),u=r(491),c=r(307),l=r(806);t.default=class{constructor(e){this._checkConfig(e),this._cancel=null,this._config=e,this._connection=null,this._socket=null}close(){this._config.transport.close()}connect(){return(0,i.default)(!this._connection,"RSocketClient: Unexpected call to connect(), already connected."),this._connection=new s.Single((e=>{const t=this._config.transport;let r;t.connectionStatus().subscribe({onNext:n=>{"CONNECTED"===n.kind?(r&&r.cancel(),e.onComplete(new d(this._config,t))):"ERROR"===n.kind?(r&&r.cancel(),e.onError(n.error)):"CLOSED"===n.kind&&(r&&r.cancel(),e.onError(new Error("RSocketClient: Connection closed.")))},onSubscribe:t=>{e.onSubscribe((()=>t.cancel())),r=t,r.request(Number.MAX_SAFE_INTEGER)}}),t.connect()})),this._connection}_checkConfig(e){const t=e.setup,r=t&&t.keepAlive;try{const e=window&&window.navigator;r>3e4&&e&&e.userAgent&&(e.userAgent.includes("Trident")||e.userAgent.includes("Edg"))&&console.warn("rsocket-js: Due to a browser bug, Internet Explorer and Edge users may experience WebSocket instability with keepAlive values longer than 30 seconds.")}catch(e){}}};class d{constructor(e,t){let r,n;const i=e.leases;if(i){const e=i();r=new c.RequesterLeaseHandler(e._receiver),n=new c.ResponderLeaseHandler(e._sender,e._stats)}const{keepAlive:a,lifetime:l}=e.setup;this._machine=(0,u.createClientMachine)(t,(e=>t.receive().subscribe(e)),l,e.serializers,e.responder,e.errorHandler,r,n),t.sendOne(this._buildSetupFrame(e));const d=(0,s.every)(a).map((()=>({data:null,flags:o.FLAGS.RESPOND,lastReceivedPosition:0,streamId:o.CONNECTION_STREAM_ID,type:o.FRAME_TYPES.KEEPALIVE})));t.send(d)}fireAndForget(e){this._machine.fireAndForget(e)}requestResponse(e){return this._machine.requestResponse(e)}requestStream(e){return this._machine.requestStream(e)}requestChannel(e){return this._machine.requestChannel(e)}metadataPush(e){return this._machine.metadataPush(e)}close(){this._machine.close()}connectionStatus(){return this._machine.connectionStatus()}availability(){return this._machine.availability()}_buildSetupFrame(e){const{dataMimeType:t,keepAlive:r,lifetime:n,metadataMimeType:s,payload:i}=e.setup,u=e.serializers||l.IdentitySerializers,c=i?u.data.serialize(i.data):void 0,d=i?u.metadata.serialize(i.metadata):void 0;let f=0;return void 0!==d&&(f|=o.FLAGS.METADATA),{data:c,dataMimeType:t,flags:f|(e.leases?o.FLAGS.LEASE:0),keepAlive:r,lifetime:n,majorVersion:a.MAJOR_VERSION,metadata:d,metadataMimeType:s,minorVersion:a.MINOR_VERSION,resumeToken:null,streamId:o.CONNECTION_STREAM_ID,type:o.FRAME_TYPES.SETUP}}}},882:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferEncoders=t.Utf8Encoders=t.BufferEncoder=t.UTF8Encoder=void 0;var n,s=r(502),i=(n=r(759))&&n.__esModule?n:{default:n};const o=t.UTF8Encoder={byteLength:e=>(0,s.byteLength)(e,"utf8"),decode:(e,t,r)=>e.toString("utf8",t,r),encode:(e,t,r,n)=>((0,i.default)("string"==typeof e,"RSocketEncoding: Expected value to be a string, got `%s`.",e),t.write(e,r,n-r,"utf8"),n)},a=t.BufferEncoder={byteLength:e=>((0,i.default)(Buffer.isBuffer(e),"RSocketEncoding: Expected value to be a buffer, got `%s`.",e),e.length),decode:(e,t,r)=>e.slice(t,r),encode:(e,t,r,n)=>((0,i.default)(Buffer.isBuffer(e),"RSocketEncoding: Expected value to be a buffer, got `%s`.",e),e.copy(t,r,0,e.length),n)};t.Utf8Encoders={data:o,dataMimeType:o,message:o,metadata:o,metadataMimeType:o,resumeToken:o},t.BufferEncoders={data:a,dataMimeType:o,message:o,metadata:a,metadataMimeType:o,resumeToken:a}},148:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_VERSION=t.MAX_TTL=t.MAX_STREAM_ID=t.MAX_RESUME_LENGTH=t.MAX_REQUEST_N=t.MAX_REQUEST_COUNT=t.MAX_MIME_LENGTH=t.MAX_METADATA_LENGTH=t.MAX_LIFETIME=t.MAX_KEEPALIVE=t.MAX_CODE=t.FRAME_TYPE_OFFFSET=t.FLAGS_MASK=t.ERROR_EXPLANATIONS=t.ERROR_CODES=t.FLAGS=t.FRAME_TYPE_NAMES=t.FRAME_TYPES=t.CONNECTION_STREAM_ID=void 0,t.isIgnore=function(e){return(e&u.IGNORE)===u.IGNORE},t.isMetadata=function(e){return(e&u.METADATA)===u.METADATA},t.isComplete=function(e){return(e&u.COMPLETE)===u.COMPLETE},t.isNext=function(e){return(e&u.NEXT)===u.NEXT},t.isRespond=function(e){return(e&u.RESPOND)===u.RESPOND},t.isResumeEnable=function(e){return(e&u.RESUME_ENABLE)===u.RESUME_ENABLE},t.isLease=function(e){return(e&u.LEASE)===u.LEASE},t.isResumePositionFrameType=function(e){return e===o.CANCEL||e===o.ERROR||e===o.PAYLOAD||e===o.REQUEST_CHANNEL||e===o.REQUEST_FNF||e===o.REQUEST_RESPONSE||e===o.REQUEST_STREAM||e===o.REQUEST_N},t.getFrameTypeName=d,t.createErrorFromFrame=function(e){const{code:t,message:r}=e,n=f(t),i=new Error((0,s.default)("RSocket error %s (%s): %s. See error `source` property for details.",E(t),n,r));return i.source={code:t,explanation:n,message:r},i},t.getErrorCodeExplanation=f,t.printFrame=function(e){const t=Object.assign({},e);t.type=d(e.type)+` (${E(e.type)})`;const r=[];return(0,n.default)(u,((t,n)=>{(e.flags&t)===t&&r.push(n)})),r.length||r.push("NO FLAGS"),t.flags=r.join(" | ")+` (${E(e.flags)})`,e.type===o.ERROR&&(t.code=f(e.code)+` (${E(e.code)})`),JSON.stringify(t,null,2)};var n=i(r(614)),s=i(r(857));function i(e){return e&&e.__esModule?e:{default:e}}t.CONNECTION_STREAM_ID=0;const o=t.FRAME_TYPES={CANCEL:9,ERROR:11,EXT:63,KEEPALIVE:3,LEASE:2,METADATA_PUSH:12,PAYLOAD:10,REQUEST_CHANNEL:7,REQUEST_FNF:5,REQUEST_N:8,REQUEST_RESPONSE:4,REQUEST_STREAM:6,RESERVED:0,RESUME:13,RESUME_OK:14,SETUP:1},a=t.FRAME_TYPE_NAMES={};(0,n.default)(o,((e,t)=>{a[e]=t}));const u=t.FLAGS={COMPLETE:64,FOLLOWS:128,IGNORE:512,LEASE:64,METADATA:256,NEXT:32,RESPOND:128,RESUME_ENABLE:128},c=t.ERROR_CODES={APPLICATION_ERROR:513,CANCELED:515,CONNECTION_CLOSE:258,CONNECTION_ERROR:257,INVALID:516,INVALID_SETUP:1,REJECTED:514,REJECTED_RESUME:4,REJECTED_SETUP:3,RESERVED:0,RESERVED_EXTENSION:4294967295,UNSUPPORTED_SETUP:2},l=t.ERROR_EXPLANATIONS={};function d(e){const t=a[e];return null!=t?t:E(e)}function f(e){const t=l[e];return null!=t?t:e<=768?"RESERVED (PROTOCOL)":"RESERVED (APPLICATION)"}function E(e){return"0x"+e.toString(16)}(0,n.default)(c,((e,t)=>{l[e]=t})),t.FLAGS_MASK=1023,t.FRAME_TYPE_OFFFSET=10,t.MAX_CODE=2147483647,t.MAX_KEEPALIVE=2147483647,t.MAX_LIFETIME=2147483647,t.MAX_METADATA_LENGTH=16777215,t.MAX_MIME_LENGTH=255,t.MAX_REQUEST_COUNT=2147483647,t.MAX_REQUEST_N=2147483647,t.MAX_RESUME_LENGTH=65535,t.MAX_STREAM_ID=2147483647,t.MAX_TTL=2147483647,t.MAX_VERSION=65535},307:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResponderLeaseHandler=t.RequesterLeaseHandler=t.Leases=t.Lease=void 0;var n,s=(n=r(759))&&n.__esModule?n:{default:n},i=r(956),o=r(148);class a{constructor(e,t,r){(0,s.default)(e>0,"Lease time-to-live must be positive"),(0,s.default)(t>0,"Lease allowed requests must be positive"),this.timeToLiveMillis=e,this.allowedRequests=t,this.startingAllowedRequests=t,this.expiry=Date.now()+e,this.metadata=r}expired(){return Date.now()>this.expiry}valid(){return this.allowedRequests>0&&!this.expired()}_use(){if(this.expired())return!1;const e=this.allowedRequests,t=e>0;return t&&(this.allowedRequests=e-1),t}}function u(e){if(!e)return"Lease was not received yet";if(e.valid())return"Missing leases";{const t=e.expired(),r=e.allowedRequests;return`Missing leases. Expired: ${t.toString()}, allowedRequests: ${r}`}}t.Lease=a,t.Leases=class{constructor(){this._sender=()=>i.Flowable.never(),this._receiver=e=>{}}sender(e){return this._sender=e,this}receiver(e){return this._receiver=e,this}stats(e){return this._stats=e,this}},t.RequesterLeaseHandler=class{constructor(e){this._requestN=-1,e(new i.Flowable((e=>{this._subscriber?e.onError(new Error("only 1 subscriber is allowed")):this.isDisposed()?e.onComplete():(this._subscriber=e,e.onSubscribe({cancel:()=>{this.dispose()},request:t=>{if(t<=0&&e.onError(new Error("request demand must be positive: "+t)),!this.isDisposed()){const e=this._requestN;this._onRequestN(e),this._requestN=Math.min(Number.MAX_SAFE_INTEGER,Math.max(0,e)+t)}}}))})))}use(){const e=this._lease;return!!e&&e._use()}errorMessage(){return u(this._lease)}receive(e){if(!this.isDisposed()){const t=e.ttl,r=e.requestCount,n=e.metadata;this._onLease(new a(t,r,n))}}availability(){const e=this._lease;return e&&e.valid()?e.allowedRequests/e.startingAllowedRequests:0}dispose(){if(!this._isDisposed){this._isDisposed=!0;const e=this._subscriber;e&&e.onComplete()}}isDisposed(){return this._isDisposed}_onRequestN(e){const t=this._lease,r=this._subscriber;e<0&&t&&r&&r.onNext(t)}_onLease(e){const t=this._subscriber,r=this._requestN-1;r>=0&&t&&t.onNext(e),this._requestN=Math.max(-1,r),this._lease=e}},t.ResponderLeaseHandler=class{constructor(e,t,r){this._leaseSender=e,this._stats=t,this._errorConsumer=r}use(){const e=this._lease,t=!!e&&e._use();return this._onStatsEvent(t),t}errorMessage(){return u(this._lease)}send(e){let t,r;return this._leaseSender(this._stats).subscribe({onComplete:()=>this._onStatsEvent(),onError:e=>{this._onStatsEvent();const t=this._errorConsumer;t&&t(e)},onNext:t=>{this._lease=t,e(t)},onSubscribe:e=>{r?e.cancel():(e.request(o.MAX_REQUEST_N),t=e)}}),{dispose(){r||(r=!0,this._onStatsEvent(),t&&t.cancel())},isDisposed:()=>r}}_onStatsEvent(e){const t=this._stats;if(t){const r=void 0===e?"Terminate":e?"Accept":"Reject";t.onEvent(r)}}}},491:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createServerMachine=function(e,t,r,n,s,i,o){return new l("SERVER",e,t,r,n,void 0,s,i,o)},t.createClientMachine=function(e,t,r,n,s,i,o,a){return new l("CLIENT",e,t,r,n,s,i,o,a)};var n=r(956),s=u(r(139)),i=(u(r(759)),u(r(620))),o=r(148),a=r(806);function u(e){return e&&e.__esModule?e:{default:e}}r(307);class c{constructor(e){this._responder=e||{}}setResponder(e){this._responder=e||{}}fireAndForget(e){if(this._responder.fireAndForget)try{this._responder.fireAndForget(e)}catch(e){console.error("fireAndForget threw an exception",e)}}requestResponse(e){let t;if(this._responder.requestResponse)try{return this._responder.requestResponse(e)}catch(e){console.error("requestResponse threw an exception",e),t=e}return n.Single.error(t||new Error("not implemented"))}requestStream(e){let t;if(this._responder.requestStream)try{return this._responder.requestStream(e)}catch(e){console.error("requestStream threw an exception",e),t=e}return n.Flowable.error(t||new Error("not implemented"))}requestChannel(e){let t;if(this._responder.requestChannel)try{return this._responder.requestChannel(e)}catch(e){console.error("requestChannel threw an exception",e),t=e}return n.Flowable.error(t||new Error("not implemented"))}metadataPush(e){let t;if(this._responder.metadataPush)try{return this._responder.metadataPush(e)}catch(e){console.error("metadataPush threw an exception",e),t=e}return n.Single.error(t||new Error("not implemented"))}}class l{constructor(e,t,r,n,s,i,u,l,d){this._connectionAvailability=1,this._handleTransportClose=()=>{this._handleError(new Error("RSocket: The connection was closed."))},this._handleError=e=>{this._receivers.forEach((t=>{t.onError(e)})),this._receivers.clear(),this._subscriptions.forEach((e=>{e.cancel()})),this._subscriptions.clear(),this._connectionAvailability=0,this._dispose(this._requesterLeaseHandler,this._responderLeaseSenderDisposable);const t=this._keepAliveTimerHandle;t&&(clearTimeout(t),this._keepAliveTimerHandle=null)},this._handleFrame=e=>{const{streamId:t}=e;t===o.CONNECTION_STREAM_ID?this._handleConnectionFrame(e):this._handleStreamFrame(t,e)},this._connection=t,this._requesterLeaseHandler=l,this._responderLeaseHandler=d,this._nextStreamId="CLIENT"===e?1:2,this._receivers=new Map,this._subscriptions=new Map,this._serializers=s||a.IdentitySerializers,this._requestHandler=new c(i),this._errorHandler=u,r({onComplete:this._handleTransportClose,onError:this._handleError,onNext:this._handleFrame,onSubscribe:e=>e.request(Number.MAX_SAFE_INTEGER)});const f=this._responderLeaseHandler;f&&(this._responderLeaseSenderDisposable=f.send(this._leaseFrameSender())),this._connection.connectionStatus().subscribe({onNext:e=>{"CLOSED"===e.kind?this._handleTransportClose():"ERROR"===e.kind&&this._handleError(e.error)},onSubscribe:e=>e.request(Number.MAX_SAFE_INTEGER)}),this._keepAliveLastReceivedMillis=Date.now();const E=()=>{const e=Date.now()-this._keepAliveLastReceivedMillis;e>=n?this._handleConnectionError(new Error(`No keep-alive acks for ${n} millis`)):this._keepAliveTimerHandle=setTimeout(E,Math.max(100,n-e))};this._keepAliveTimerHandle=setTimeout(E,n)}setRequestHandler(e){this._requestHandler.setResponder(e)}close(){this._connection.close()}connectionStatus(){return this._connection.connectionStatus()}availability(){const e=this._requesterLeaseHandler,t=e?e.availability():1;return Math.min(this._connectionAvailability,t)}fireAndForget(e){if(this._useLeaseOrError(this._requesterLeaseHandler))return;const t=this._getNextStreamId(this._receivers),r=this._serializers.data.serialize(e.data),n=this._serializers.metadata.serialize(e.metadata),s={data:r,flags:void 0!==e.metadata?o.FLAGS.METADATA:0,metadata:n,streamId:t,type:o.FRAME_TYPES.REQUEST_FNF};this._connection.sendOne(s)}requestResponse(e){const t=this._useLeaseOrError(this._requesterLeaseHandler);if(t)return n.Single.error(new Error(t));const r=this._getNextStreamId(this._receivers);return new n.Single((t=>{this._receivers.set(r,{onComplete:s.default,onError:e=>t.onError(e),onNext:e=>t.onComplete(e)});const n=this._serializers.data.serialize(e.data),i=this._serializers.metadata.serialize(e.metadata),a={data:n,flags:void 0!==e.metadata?o.FLAGS.METADATA:0,metadata:i,streamId:r,type:o.FRAME_TYPES.REQUEST_RESPONSE};this._connection.sendOne(a),t.onSubscribe((()=>{this._receivers.delete(r);const e={flags:0,streamId:r,type:o.FRAME_TYPES.CANCEL};this._connection.sendOne(e)}))}))}requestStream(e){const t=this._useLeaseOrError(this._requesterLeaseHandler);if(t)return n.Flowable.error(new Error(t));const r=this._getNextStreamId(this._receivers);return new n.Flowable((t=>{this._receivers.set(r,t);let n=!1;t.onSubscribe({cancel:()=>{if(this._receivers.delete(r),!n)return;const e={flags:0,streamId:r,type:o.FRAME_TYPES.CANCEL};this._connection.sendOne(e)},request:t=>{if(t>o.MAX_REQUEST_N&&(t=o.MAX_REQUEST_N),n){const e={flags:0,requestN:t,streamId:r,type:o.FRAME_TYPES.REQUEST_N};this._connection.sendOne(e)}else{n=!0;const s=this._serializers.data.serialize(e.data),i=this._serializers.metadata.serialize(e.metadata),a={data:s,flags:void 0!==e.metadata?o.FLAGS.METADATA:0,metadata:i,requestN:t,streamId:r,type:o.FRAME_TYPES.REQUEST_STREAM};this._connection.sendOne(a)}}})}),o.MAX_REQUEST_N)}requestChannel(e){const t=this._useLeaseOrError(this._requesterLeaseHandler);if(t)return n.Flowable.error(new Error(t));const r=this._getNextStreamId(this._receivers);let s=!1;return new n.Flowable((t=>{try{this._receivers.set(r,t);let n=!1;t.onSubscribe({cancel:()=>{if(this._receivers.delete(r),!n)return;const e={flags:0,streamId:r,type:o.FRAME_TYPES.CANCEL};this._connection.sendOne(e)},request:t=>{if(t>o.MAX_REQUEST_N&&(t=o.MAX_REQUEST_N),n){const e={flags:0,requestN:t,streamId:r,type:o.FRAME_TYPES.REQUEST_N};this._connection.sendOne(e)}else s?(0,i.default)(!1,"RSocketClient: re-entrant call to request n before initial channel established."):(s=!0,e.subscribe({onComplete:()=>{this._sendStreamComplete(r)},onError:e=>{this._sendStreamError(r,e.message)},onNext:e=>{const s=this._serializers.data.serialize(e.data),i=this._serializers.metadata.serialize(e.metadata);if(n){const t={data:s,flags:o.FLAGS.NEXT|(void 0!==e.metadata?o.FLAGS.METADATA:0),metadata:i,streamId:r,type:o.FRAME_TYPES.PAYLOAD};this._connection.sendOne(t)}else{n=!0;const a={data:s,flags:void 0!==e.metadata?o.FLAGS.METADATA:0,metadata:i,requestN:t,streamId:r,type:o.FRAME_TYPES.REQUEST_CHANNEL};this._connection.sendOne(a)}},onSubscribe:e=>{this._subscriptions.set(r,e),e.request(1)}}))}})}catch(e){console.warn("Exception while subscribing to channel flowable:"+e)}}),o.MAX_REQUEST_N)}metadataPush(e){throw new Error("metadataPush() is not implemented")}_getNextStreamId(e){const t=this._nextStreamId;do{this._nextStreamId=this._nextStreamId+2&o.MAX_STREAM_ID}while(0===this._nextStreamId||e.has(t));return t}_useLeaseOrError(e){if(e&&!e.use())return e.errorMessage()}_leaseFrameSender(){return e=>this._connection.sendOne({flags:0,metadata:e.metadata,requestCount:e.allowedRequests,streamId:o.CONNECTION_STREAM_ID,ttl:e.timeToLiveMillis,type:o.FRAME_TYPES.LEASE})}_dispose(...e){e.forEach((e=>{e&&e.dispose()}))}_isRequest(e){switch(e){case o.FRAME_TYPES.REQUEST_FNF:case o.FRAME_TYPES.REQUEST_RESPONSE:case o.FRAME_TYPES.REQUEST_STREAM:case o.FRAME_TYPES.REQUEST_CHANNEL:return!0;default:return!1}}_handleConnectionError(e){this._handleError(e),this._connection.close();const t=this._errorHandler;t&&t(e)}_handleConnectionFrame(e){switch(e.type){case o.FRAME_TYPES.ERROR:const t=(0,o.createErrorFromFrame)(e);this._handleConnectionError(t);break;case o.FRAME_TYPES.EXT:break;case o.FRAME_TYPES.KEEPALIVE:this._keepAliveLastReceivedMillis=Date.now(),(0,o.isRespond)(e.flags)&&this._connection.sendOne(Object.assign({},e,{flags:e.flags^o.FLAGS.RESPOND,lastReceivedPosition:0}));break;case o.FRAME_TYPES.LEASE:const r=this._requesterLeaseHandler;r&&r.receive(e);break;case o.FRAME_TYPES.METADATA_PUSH:case o.FRAME_TYPES.REQUEST_CHANNEL:case o.FRAME_TYPES.REQUEST_FNF:case o.FRAME_TYPES.REQUEST_RESPONSE:case o.FRAME_TYPES.REQUEST_STREAM:case o.FRAME_TYPES.RESERVED:break;case o.FRAME_TYPES.RESUME:case o.FRAME_TYPES.RESUME_OK:}}_handleStreamFrame(e,t){if(this._isRequest(t.type)){const t=this._useLeaseOrError(this._responderLeaseHandler);if(t)return void this._sendStreamError(e,t)}switch(t.type){case o.FRAME_TYPES.CANCEL:this._handleCancel(e,t);break;case o.FRAME_TYPES.REQUEST_N:this._handleRequestN(e,t);break;case o.FRAME_TYPES.REQUEST_FNF:this._handleFireAndForget(e,t);break;case o.FRAME_TYPES.REQUEST_RESPONSE:this._handleRequestResponse(e,t);break;case o.FRAME_TYPES.REQUEST_STREAM:this._handleRequestStream(e,t);break;case o.FRAME_TYPES.REQUEST_CHANNEL:this._handleRequestChannel(e,t);break;case o.FRAME_TYPES.ERROR:const r=(0,o.createErrorFromFrame)(t);this._handleStreamError(e,r);break;case o.FRAME_TYPES.PAYLOAD:const n=this._receivers.get(e);if(null!=n){if((0,o.isNext)(t.flags)){const e={data:this._serializers.data.deserialize(t.data),metadata:this._serializers.metadata.deserialize(t.metadata)};n.onNext(e)}(0,o.isComplete)(t.flags)&&(this._receivers.delete(e),n.onComplete())}}}_handleCancel(e,t){const r=this._subscriptions.get(e);r&&(r.cancel(),this._subscriptions.delete(e))}_handleRequestN(e,t){const r=this._subscriptions.get(e);r&&r.request(t.requestN)}_handleFireAndForget(e,t){const r=this._deserializePayload(t);this._requestHandler.fireAndForget(r)}_handleRequestResponse(e,t){const r=this._deserializePayload(t);this._requestHandler.requestResponse(r).subscribe({onComplete:t=>{this._sendStreamPayload(e,t,!0)},onError:t=>this._sendStreamError(e,t.message),onSubscribe:t=>{const r={cancel:t,request:s.default};this._subscriptions.set(e,r)}})}_handleRequestStream(e,t){const r=this._deserializePayload(t);this._requestHandler.requestStream(r).subscribe({onComplete:()=>this._sendStreamComplete(e),onError:t=>this._sendStreamError(e,t.message),onNext:t=>this._sendStreamPayload(e,t),onSubscribe:r=>{this._subscriptions.set(e,r),r.request(t.requestN)}})}_handleRequestChannel(e,t){if(this._subscriptions.get(e))return;const r=new n.Flowable((r=>{let n=!0;r.onSubscribe({cancel:()=>{this._receivers.delete(e);const t={flags:0,streamId:e,type:o.FRAME_TYPES.CANCEL};this._connection.sendOne(t)},request:s=>{if(s>o.MAX_REQUEST_N&&(s=o.MAX_REQUEST_N),n&&s--,s>0){const t={flags:0,requestN:s,streamId:e,type:o.FRAME_TYPES.REQUEST_N};this._connection.sendOne(t)}n&&s>=0&&(n=!1,r.onNext(t))}})}),o.MAX_REQUEST_N),s=new n.FlowableProcessor(r,(e=>this._deserializePayload(e)));this._receivers.set(e,s),this._requestHandler.requestChannel(s).subscribe({onComplete:()=>this._sendStreamComplete(e),onError:t=>this._sendStreamError(e,t.message),onNext:t=>this._sendStreamPayload(e,t),onSubscribe:r=>{this._subscriptions.set(e,r),r.request(t.requestN)}})}_sendStreamComplete(e){this._subscriptions.delete(e),this._connection.sendOne({data:null,flags:o.FLAGS.COMPLETE,metadata:null,streamId:e,type:o.FRAME_TYPES.PAYLOAD})}_sendStreamError(e,t){this._subscriptions.delete(e),this._connection.sendOne({code:o.ERROR_CODES.APPLICATION_ERROR,flags:0,message:t,streamId:e,type:o.FRAME_TYPES.ERROR})}_sendStreamPayload(e,t,r=!1){let n=o.FLAGS.NEXT;r&&(n|=o.FLAGS.COMPLETE,this._subscriptions.delete(e));const s=this._serializers.data.serialize(t.data),i=this._serializers.metadata.serialize(t.metadata);this._connection.sendOne({data:s,flags:n,metadata:i,streamId:e,type:o.FRAME_TYPES.PAYLOAD})}_deserializePayload(e){return function(e,t){return{data:e.data.deserialize(t.data),metadata:e.metadata.deserialize(t.metadata)}}(this._serializers,e)}_handleStreamError(e,t){const r=this._receivers.get(e);null!=r&&(this._receivers.delete(e),r.onError(t))}}},986:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(956),i=(n=r(759))&&n.__esModule?n:{default:n},o=r(148),a=r(833),u=r(776);t.default=class{constructor(e,t,r){(0,i.default)(t.bufferSize>=0,"RSocketResumableTransport: bufferSize option must be >= 0, got `%s`.",t.bufferSize),this._encoders=r,this._bufferSize=t.bufferSize,this._sentFramesSize=0,this._position={client:0,server:0},this._currentConnection=null,this._statusSubscription=null,this._receiveSubscription=null,this._receivers=new Set,this._resumeToken=t.resumeToken,this._sessionTimeoutMillis=1e3*t.sessionDurationSeconds,this._sessionTimeoutHandle=null,this._senders=new Set,this._sentFrames=[],this._setupFrame=null,this._source=e,this._status=a.CONNECTION_STATUS.NOT_CONNECTED,this._statusSubscribers=new Set}close(){this._close()}connect(){(0,i.default)(!this._isTerminated(),"RSocketResumableTransport: Cannot connect(), connection terminated (%s: %s).",this._status.kind,"ERROR"===this._status.kind?this._status.error.message:"no message");try{this._disconnect(),this._currentConnection=null,this._receiveSubscription=null,this._statusSubscription=null,this._setConnectionStatus(a.CONNECTION_STATUS.CONNECTING);const e=this._source();e.connectionStatus().subscribe({onNext:t=>{t.kind!==this._status.kind&&("CONNECTED"===t.kind?(this._sessionTimeoutHandle&&(clearTimeout(this._sessionTimeoutHandle),this._sessionTimeoutHandle=null),null==this._setupFrame?this._handleConnected(e):this._handleResume(e)):this._isTerminationStatus(t)&&(this._sessionTimeoutHandle||(this._sessionTimeoutHandle=setTimeout((()=>this._close(this._resumeTimeoutError())),this._sessionTimeoutMillis)),this._disconnect(),this._setConnectionStatus(a.CONNECTION_STATUS.NOT_CONNECTED)))},onSubscribe:e=>{this._statusSubscription=e,e.request(Number.MAX_SAFE_INTEGER)}}),e.connect()}catch(e){this._close(e)}}connectionStatus(){return new s.Flowable((e=>{e.onSubscribe({cancel:()=>{this._statusSubscribers.delete(e)},request:()=>{this._statusSubscribers.add(e),e.onNext(this._status)}})}))}receive(){return new s.Flowable((e=>{let t=!1;e.onSubscribe({cancel:()=>{this._receivers.delete(e)},request:()=>{t||(t=!0,this._receivers.add(e))}})}))}sendOne(e){try{this._writeFrame(e)}catch(e){this._close(e)}}send(e){let t;e.subscribe({onComplete:()=>{t&&this._senders.delete(t)},onError:e=>{t&&this._senders.delete(t),this._close(e)},onNext:e=>this._writeFrame(e),onSubscribe:e=>{t=e,this._senders.add(t),t.request(Number.MAX_SAFE_INTEGER)}})}_close(e){if(this._isTerminated())return;e?this._setConnectionStatus({error:e,kind:"ERROR"}):this._setConnectionStatus(a.CONNECTION_STATUS.CLOSED);const t=this._receivers;t.forEach((e=>e.onComplete())),t.clear();const r=this._senders;r.forEach((e=>e.cancel())),r.clear(),this._sentFrames.length=0,this._disconnect()}_disconnect(){this._statusSubscription&&(this._statusSubscription.cancel(),this._statusSubscription=null),this._receiveSubscription&&(this._receiveSubscription.cancel(),this._receiveSubscription=null),this._currentConnection&&(this._currentConnection.close(),this._currentConnection=null)}_handleConnected(e){this._currentConnection=e,this._flushFrames(),this._setConnectionStatus(a.CONNECTION_STATUS.CONNECTED),e.receive().subscribe({onNext:e=>{try{this._receiveFrame(e)}catch(e){this._close(e)}},onSubscribe:e=>{this._receiveSubscription=e,e.request(Number.MAX_SAFE_INTEGER)}})}_handleResume(e){e.receive().take(1).subscribe({onNext:t=>{try{if(t.type===o.FRAME_TYPES.RESUME_OK){const{clientPosition:r}=t;if(r<this._position.client)return void this._close(this._nonResumableStateError());let n=r-this._position.client,s=0;for(;n>0;){const e=this._onReleasedTailFrame(this._sentFrames[s]);if(!e)return void this._close(this._absentLengthError(t));n-=e,s++}if(0!==n)return void this._close(this._inconsistentImpliedPositionError());s>0&&this._sentFrames.splice(0,s),this._handleConnected(e)}else{const e=t.type===o.FRAME_TYPES.ERROR?(0,o.createErrorFromFrame)(t):new Error("RSocketResumableTransport: Resumption failed for an unspecified reason.");this._close(e)}}catch(e){this._close(e)}},onSubscribe:e=>{this._receiveSubscription=e,e.request(1)}});const t=this._setupFrame;(0,i.default)(t,"RSocketResumableTransport: Cannot resume, setup frame has not been sent."),e.sendOne({clientPosition:this._position.client,flags:0,majorVersion:t.majorVersion,minorVersion:t.minorVersion,resumeToken:this._resumeToken,serverPosition:this._position.server,streamId:o.CONNECTION_STREAM_ID,type:o.FRAME_TYPES.RESUME})}_absentLengthError(e){return new Error("RSocketResumableTransport: absent frame.length for type "+e.type)}_inconsistentImpliedPositionError(){return new Error("RSocketResumableTransport: local frames are inconsistent with remote implied position")}_nonResumableStateError(){return new Error("RSocketResumableTransport: resumption failed, server is missing frames that are no longer in the client buffer.")}_resumeTimeoutError(){return new Error("RSocketResumableTransport: resumable session timed out")}_isTerminated(){return this._isTerminationStatus(this._status)}_isTerminationStatus(e){const t=e.kind;return"CLOSED"===t||"ERROR"===t}_setConnectionStatus(e){e.kind!==this._status.kind&&(this._status=e,this._statusSubscribers.forEach((t=>t.onNext(e))))}_receiveFrame(e){(0,o.isResumePositionFrameType)(e.type)&&(this._position.server+=e.length),this._receivers.forEach((t=>t.onNext(e)))}_flushFrames(){this._sentFrames.forEach((e=>{const t=this._currentConnection;t&&t.sendOne(e)}))}_onReleasedTailFrame(e){const t=e.length;if(t)return this._sentFramesSize-=t,this._position.client+=t,t}_writeFrame(e){if(e.type===o.FRAME_TYPES.SETUP&&(e=Object.assign({},e,{flags:e.flags|o.FLAGS.RESUME_ENABLE,resumeToken:this._resumeToken}),this._setupFrame=e),e.length=(0,u.sizeOfFrame)(e,this._encoders),(0,o.isResumePositionFrameType)(e.type)){let t=this._bufferSize-this._sentFramesSize;const r=e.length;if(!r)return void this._close(this._absentLengthError(e));for(;t<r;){const r=this._sentFrames.shift();if(!r)break;{const n=this._onReleasedTailFrame(r);if(!n)return void this._close(this._absentLengthError(e));t+=n}}t>=r?(this._sentFrames.push(e),this._sentFramesSize+=r):this._position.client+=r}const t=this._currentConnection;t&&t.sendOne(e)}}},806:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentitySerializers=t.IdentitySerializer=t.JsonSerializers=t.JsonSerializer=void 0;var n,s=r(771),i=(n=r(759))&&n.__esModule?n:{default:n};const o=t.JsonSerializer={deserialize:e=>{let t;return null==e?null:(t="string"==typeof e?e:s.LiteBuffer.isBuffer(e)?e.toString("utf8"):s.LiteBuffer.from(e).toString("utf8"),JSON.parse(t))},serialize:JSON.stringify},a=(t.JsonSerializers={data:o,metadata:o},t.IdentitySerializer={deserialize:e=>((0,i.default)(null==e||"string"==typeof e||s.LiteBuffer.isBuffer(e)||e instanceof Uint8Array,"RSocketSerialization: Expected data to be a string, Buffer, or Uint8Array. Got `%s`.",e),e),serialize:e=>e});t.IdentitySerializers={data:a,metadata:a}},268:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(956);var n,s=(n=r(759))&&n.__esModule?n:{default:n},i=r(148),o=r(806),a=r(491),u=r(307);t.default=class{constructor(e){this._handleTransportComplete=()=>{this._handleTransportError(new Error("RSocketServer: Connection closed unexpectedly."))},this._handleTransportError=e=>{this._connections.forEach((e=>{e.close()}))},this._handleTransportConnection=e=>{const t=new c;let r;e.receive().subscribe(t.swap({onError:e=>console.error(e),onNext:r=>{switch(r.type){case i.FRAME_TYPES.RESUME:e.sendOne({code:i.ERROR_CODES.REJECTED_RESUME,flags:0,message:"RSocketServer: RESUME not supported.",streamId:i.CONNECTION_STREAM_ID,type:i.FRAME_TYPES.ERROR}),e.close();break;case i.FRAME_TYPES.SETUP:if(this._setupLeaseError(r)){e.sendOne({code:i.ERROR_CODES.INVALID_SETUP,flags:0,message:"RSocketServer: LEASE not supported.",streamId:i.CONNECTION_STREAM_ID,type:i.FRAME_TYPES.ERROR}),e.close();break}const n=this._getSerializers();let o,c;const l=this._config.leases;if(l){const e=l();o=new u.RequesterLeaseHandler(e._receiver),c=new u.ResponderLeaseHandler(e._sender,e._stats)}const d=(0,a.createServerMachine)(e,(e=>{t.swap(e)}),r.lifetime,n,this._config.errorHandler,o,c);try{const e=this._config.getRequestHandler(d,function(e,t){return{data:e.data.deserialize(t.data),metadata:e.metadata.deserialize(t.metadata)}}(n,r));d.setRequestHandler(e),this._connections.add(d)}catch(t){e.sendOne({code:i.ERROR_CODES.REJECTED_SETUP,flags:0,message:"Application rejected setup, reason: "+t.message,streamId:i.CONNECTION_STREAM_ID,type:i.FRAME_TYPES.ERROR}),e.close()}break;default:(0,s.default)(!1,"RSocketServer: Expected first frame to be SETUP or RESUME, got `%s`.",(0,i.getFrameTypeName)(r.type))}},onSubscribe:e=>{r=e,r.request(1)}}))},this._config=e,this._connections=new Set,this._started=!1,this._subscription=null}start(){(0,s.default)(!this._started,"RSocketServer: Unexpected call to start(), already started."),this._started=!0,this._config.transport.start().subscribe({onComplete:this._handleTransportComplete,onError:this._handleTransportError,onNext:this._handleTransportConnection,onSubscribe:e=>{this._subscription=e,e.request(Number.MAX_SAFE_INTEGER)}})}stop(){this._subscription&&this._subscription.cancel(),this._config.transport.stop(),this._handleTransportError(new Error("RSocketServer: Connection terminated via stop()."))}_getSerializers(){return this._config.serializers||o.IdentitySerializers}_setupLeaseError(e){const t=(e.flags&i.FLAGS.LEASE)===i.FLAGS.LEASE,r=this._config.leases;return t&&!r}};class c{constructor(e){this._target=e}swap(e){return this._target=e,this._subscription&&this._target.onSubscribe&&this._target.onSubscribe(this._subscription),this}onComplete(){(0,s.default)(this._target,"must have target"),this._target.onComplete&&this._target.onComplete()}onError(e){(0,s.default)(this._target,"must have target"),this._target.onError&&this._target.onError(e)}onNext(e){(0,s.default)(this._target,"must have target"),this._target.onNext&&this._target.onNext(e)}onSubscribe(e){(0,s.default)(this._target,"must have target"),this._subscription=e,this._target.onSubscribe&&this._target.onSubscribe(e)}}},605:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAJOR_VERSION=1,t.MINOR_VERSION=0},369:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){this._string=e,this._identifier=t}static fromIdentifier(e){return e<0||e>127?n:K[e]}static fromString(e){if(!e)throw new Error("type must be non-null");return e===s.string?n:W.get(e)||n}get identifier(){return this._identifier}get string(){return this._string}toString(){return this._string}}t.default=r;const n=t.UNPARSEABLE_MIME_TYPE=new r("UNPARSEABLE_MIME_TYPE_DO_NOT_USE",-2),s=t.UNKNOWN_RESERVED_MIME_TYPE=new r("UNKNOWN_YET_RESERVED_DO_NOT_USE",-1),i=t.APPLICATION_AVRO=new r("application/avro",0),o=t.APPLICATION_CBOR=new r("application/cbor",1),a=t.APPLICATION_GRAPHQL=new r("application/graphql",2),u=t.APPLICATION_GZIP=new r("application/gzip",3),c=t.APPLICATION_JAVASCRIPT=new r("application/javascript",4),l=t.APPLICATION_JSON=new r("application/json",5),d=t.APPLICATION_OCTET_STREAM=new r("application/octet-stream",6),f=t.APPLICATION_PDF=new r("application/pdf",7),E=t.APPLICATION_THRIFT=new r("application/vnd.apache.thrift.binary",8),h=t.APPLICATION_PROTOBUF=new r("application/vnd.google.protobuf",9),_=t.APPLICATION_XML=new r("application/xml",10),p=t.APPLICATION_ZIP=new r("application/zip",11),m=t.AUDIO_AAC=new r("audio/aac",12),b=t.AUDIO_MP3=new r("audio/mp3",13),S=t.AUDIO_MP4=new r("audio/mp4",14),g=t.AUDIO_MPEG3=new r("audio/mpeg3",15),A=t.AUDIO_MPEG=new r("audio/mpeg",16),T=t.AUDIO_OGG=new r("audio/ogg",17),y=t.AUDIO_OPUS=new r("audio/opus",18),R=t.AUDIO_VORBIS=new r("audio/vorbis",19),I=t.IMAGE_BMP=new r("image/bmp",20),M=t.IMAGE_GIG=new r("image/gif",21),O=t.IMAGE_HEIC_SEQUENCE=new r("image/heic-sequence",22),P=t.IMAGE_HEIC=new r("image/heic",23),N=t.IMAGE_HEIF_SEQUENCE=new r("image/heif-sequence",24),w=t.IMAGE_HEIF=new r("image/heif",25),v=t.IMAGE_JPEG=new r("image/jpeg",26),C=t.IMAGE_PNG=new r("image/png",27),L=t.IMAGE_TIFF=new r("image/tiff",28),F=t.MULTIPART_MIXED=new r("multipart/mixed",29),U=t.TEXT_CSS=new r("text/css",30),B=t.TEXT_CSV=new r("text/csv",31),k=t.TEXT_HTML=new r("text/html",32),x=t.TEXT_PLAIN=new r("text/plain",33),D=t.TEXT_XML=new r("text/xml",34),G=t.VIDEO_H264=new r("video/H264",35),j=t.VIDEO_H265=new r("video/H265",36),q=t.VIDEO_VP8=new r("video/VP8",37),Y=t.APPLICATION_HESSIAN=new r("application/x-hessian",38),z=t.APPLICATION_JAVA_OBJECT=new r("application/x-java-object",39),X=t.APPLICATION_CLOUDEVENTS_JSON=new r("application/cloudevents+json",40),H=t.MESSAGE_RSOCKET_TRACING_ZIPKIN=new r("message/x.rsocket.tracing-zipkin.v0",125),V=t.MESSAGE_RSOCKET_ROUTING=new r("message/x.rsocket.routing.v0",126),Q=t.MESSAGE_RSOCKET_COMPOSITE_METADATA=new r("message/x.rsocket.composite-metadata.v0",127),K=t.TYPES_BY_MIME_ID=new Array(128),W=t.TYPES_BY_MIME_STRING=new Map,J=[n,s,i,o,a,u,c,l,d,f,E,h,_,p,m,b,S,g,A,T,y,R,I,M,O,P,N,w,v,C,L,F,U,B,k,x,D,G,j,q,Y,z,X,H,V,Q];K.fill(s);for(let e of J)e.identifier>=0&&(K[e.identifier]=e,W.set(e.string,e));Object.seal&&Object.seal(K)},269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeAndAddWellKnownMetadata=t.encodeAndAddCustomMetadata=t.ExplicitMimeTimeEntry=t.WellKnownMimeTypeEntry=t.ReservedMimeTypeEntry=t.CompositeMetadata=t.MESSAGE_RSOCKET_COMPOSITE_METADATA=t.MESSAGE_RSOCKET_ROUTING=t.MESSAGE_RSOCKET_TRACING_ZIPKIN=t.APPLICATION_CLOUDEVENTS_JSON=t.APPLICATION_JAVA_OBJECT=t.APPLICATION_HESSIAN=t.VIDEO_VP8=t.VIDEO_H265=t.VIDEO_H264=t.TEXT_XML=t.TEXT_PLAIN=t.TEXT_HTML=t.TEXT_CSV=t.TEXT_CSS=t.MULTIPART_MIXED=t.IMAGE_TIFF=t.IMAGE_PNG=t.IMAGE_JPEG=t.IMAGE_HEIF=t.IMAGE_HEIF_SEQUENCE=t.IMAGE_HEIC=t.IMAGE_HEIC_SEQUENCE=t.IMAGE_GIG=t.IMAGE_BMP=t.AUDIO_VORBIS=t.AUDIO_OPUS=t.AUDIO_OGG=t.AUDIO_MPEG=t.AUDIO_MPEG3=t.AUDIO_MP4=t.AUDIO_MP3=t.AUDIO_AAC=t.APPLICATION_ZIP=t.APPLICATION_XML=t.APPLICATION_PROTOBUF=t.APPLICATION_THRIFT=t.APPLICATION_PDF=t.APPLICATION_OCTET_STREAM=t.APPLICATION_JSON=t.APPLICATION_JAVASCRIPT=t.APPLICATION_GZIP=t.APPLICATION_GRAPHQL=t.APPLICATION_CBOR=t.APPLICATION_AVRO=t.UNKNOWN_RESERVED_MIME_TYPE=t.UNPARSEABLE_MIME_TYPE=t.Lease=t.Leases=t.JsonSerializers=t.JsonSerializer=t.IdentitySerializers=t.IdentitySerializer=t.UTF8Encoder=t.Utf8Encoders=t.BufferEncoder=t.BufferEncoders=t.writeUInt24BE=t.toBuffer=t.readUInt24BE=t.createBuffer=t.byteLength=t.serializeFrameWithLength=t.serializeFrame=t.deserializeFrames=t.deserializeFrameWithLength=t.deserializeFrame=t.printFrame=t.isResumeEnable=t.isRespond=t.isNext=t.isMetadata=t.isLease=t.isIgnore=t.isComplete=t.getErrorCodeExplanation=t.createErrorFromFrame=t.MAX_VERSION=t.MAX_STREAM_ID=t.MAX_RESUME_LENGTH=t.MAX_MIME_LENGTH=t.MAX_LIFETIME=t.MAX_KEEPALIVE=t.MAX_CODE=t.FRAME_TYPES=t.FRAME_TYPE_OFFFSET=t.FLAGS=t.FLAGS_MASK=t.ERROR_EXPLANATIONS=t.ERROR_CODES=t.CONNECTION_STREAM_ID=t.WellKnownMimeType=t.RSocketResumableTransport=t.RSocketServer=t.RSocketClient=void 0;var n=r(148);Object.defineProperty(t,"CONNECTION_STREAM_ID",{enumerable:!0,get:function(){return n.CONNECTION_STREAM_ID}}),Object.defineProperty(t,"ERROR_CODES",{enumerable:!0,get:function(){return n.ERROR_CODES}}),Object.defineProperty(t,"ERROR_EXPLANATIONS",{enumerable:!0,get:function(){return n.ERROR_EXPLANATIONS}}),Object.defineProperty(t,"FLAGS_MASK",{enumerable:!0,get:function(){return n.FLAGS_MASK}}),Object.defineProperty(t,"FLAGS",{enumerable:!0,get:function(){return n.FLAGS}}),Object.defineProperty(t,"FRAME_TYPE_OFFFSET",{enumerable:!0,get:function(){return n.FRAME_TYPE_OFFFSET}}),Object.defineProperty(t,"FRAME_TYPES",{enumerable:!0,get:function(){return n.FRAME_TYPES}}),Object.defineProperty(t,"MAX_CODE",{enumerable:!0,get:function(){return n.MAX_CODE}}),Object.defineProperty(t,"MAX_KEEPALIVE",{enumerable:!0,get:function(){return n.MAX_KEEPALIVE}}),Object.defineProperty(t,"MAX_LIFETIME",{enumerable:!0,get:function(){return n.MAX_LIFETIME}}),Object.defineProperty(t,"MAX_MIME_LENGTH",{enumerable:!0,get:function(){return n.MAX_MIME_LENGTH}}),Object.defineProperty(t,"MAX_RESUME_LENGTH",{enumerable:!0,get:function(){return n.MAX_RESUME_LENGTH}}),Object.defineProperty(t,"MAX_STREAM_ID",{enumerable:!0,get:function(){return n.MAX_STREAM_ID}}),Object.defineProperty(t,"MAX_VERSION",{enumerable:!0,get:function(){return n.MAX_VERSION}}),Object.defineProperty(t,"createErrorFromFrame",{enumerable:!0,get:function(){return n.createErrorFromFrame}}),Object.defineProperty(t,"getErrorCodeExplanation",{enumerable:!0,get:function(){return n.getErrorCodeExplanation}}),Object.defineProperty(t,"isComplete",{enumerable:!0,get:function(){return n.isComplete}}),Object.defineProperty(t,"isIgnore",{enumerable:!0,get:function(){return n.isIgnore}}),Object.defineProperty(t,"isLease",{enumerable:!0,get:function(){return n.isLease}}),Object.defineProperty(t,"isMetadata",{enumerable:!0,get:function(){return n.isMetadata}}),Object.defineProperty(t,"isNext",{enumerable:!0,get:function(){return n.isNext}}),Object.defineProperty(t,"isRespond",{enumerable:!0,get:function(){return n.isRespond}}),Object.defineProperty(t,"isResumeEnable",{enumerable:!0,get:function(){return n.isResumeEnable}}),Object.defineProperty(t,"printFrame",{enumerable:!0,get:function(){return n.printFrame}});var s=r(776);Object.defineProperty(t,"deserializeFrame",{enumerable:!0,get:function(){return s.deserializeFrame}}),Object.defineProperty(t,"deserializeFrameWithLength",{enumerable:!0,get:function(){return s.deserializeFrameWithLength}}),Object.defineProperty(t,"deserializeFrames",{enumerable:!0,get:function(){return s.deserializeFrames}}),Object.defineProperty(t,"serializeFrame",{enumerable:!0,get:function(){return s.serializeFrame}}),Object.defineProperty(t,"serializeFrameWithLength",{enumerable:!0,get:function(){return s.serializeFrameWithLength}});var i=r(502);Object.defineProperty(t,"byteLength",{enumerable:!0,get:function(){return i.byteLength}}),Object.defineProperty(t,"createBuffer",{enumerable:!0,get:function(){return i.createBuffer}}),Object.defineProperty(t,"readUInt24BE",{enumerable:!0,get:function(){return i.readUInt24BE}}),Object.defineProperty(t,"toBuffer",{enumerable:!0,get:function(){return i.toBuffer}}),Object.defineProperty(t,"writeUInt24BE",{enumerable:!0,get:function(){return i.writeUInt24BE}});var o=r(882);Object.defineProperty(t,"BufferEncoders",{enumerable:!0,get:function(){return o.BufferEncoders}}),Object.defineProperty(t,"BufferEncoder",{enumerable:!0,get:function(){return o.BufferEncoder}}),Object.defineProperty(t,"Utf8Encoders",{enumerable:!0,get:function(){return o.Utf8Encoders}}),Object.defineProperty(t,"UTF8Encoder",{enumerable:!0,get:function(){return o.UTF8Encoder}});var a=r(806);Object.defineProperty(t,"IdentitySerializer",{enumerable:!0,get:function(){return a.IdentitySerializer}}),Object.defineProperty(t,"IdentitySerializers",{enumerable:!0,get:function(){return a.IdentitySerializers}}),Object.defineProperty(t,"JsonSerializer",{enumerable:!0,get:function(){return a.JsonSerializer}}),Object.defineProperty(t,"JsonSerializers",{enumerable:!0,get:function(){return a.JsonSerializers}});var u=r(307);Object.defineProperty(t,"Leases",{enumerable:!0,get:function(){return u.Leases}}),Object.defineProperty(t,"Lease",{enumerable:!0,get:function(){return u.Lease}});var c=r(369);Object.defineProperty(t,"UNPARSEABLE_MIME_TYPE",{enumerable:!0,get:function(){return c.UNPARSEABLE_MIME_TYPE}}),Object.defineProperty(t,"UNKNOWN_RESERVED_MIME_TYPE",{enumerable:!0,get:function(){return c.UNKNOWN_RESERVED_MIME_TYPE}}),Object.defineProperty(t,"APPLICATION_AVRO",{enumerable:!0,get:function(){return c.APPLICATION_AVRO}}),Object.defineProperty(t,"APPLICATION_CBOR",{enumerable:!0,get:function(){return c.APPLICATION_CBOR}}),Object.defineProperty(t,"APPLICATION_GRAPHQL",{enumerable:!0,get:function(){return c.APPLICATION_GRAPHQL}}),Object.defineProperty(t,"APPLICATION_GZIP",{enumerable:!0,get:function(){return c.APPLICATION_GZIP}}),Object.defineProperty(t,"APPLICATION_JAVASCRIPT",{enumerable:!0,get:function(){return c.APPLICATION_JAVASCRIPT}}),Object.defineProperty(t,"APPLICATION_JSON",{enumerable:!0,get:function(){return c.APPLICATION_JSON}}),Object.defineProperty(t,"APPLICATION_OCTET_STREAM",{enumerable:!0,get:function(){return c.APPLICATION_OCTET_STREAM}}),Object.defineProperty(t,"APPLICATION_PDF",{enumerable:!0,get:function(){return c.APPLICATION_PDF}}),Object.defineProperty(t,"APPLICATION_THRIFT",{enumerable:!0,get:function(){return c.APPLICATION_THRIFT}}),Object.defineProperty(t,"APPLICATION_PROTOBUF",{enumerable:!0,get:function(){return c.APPLICATION_PROTOBUF}}),Object.defineProperty(t,"APPLICATION_XML",{enumerable:!0,get:function(){return c.APPLICATION_XML}}),Object.defineProperty(t,"APPLICATION_ZIP",{enumerable:!0,get:function(){return c.APPLICATION_ZIP}}),Object.defineProperty(t,"AUDIO_AAC",{enumerable:!0,get:function(){return c.AUDIO_AAC}}),Object.defineProperty(t,"AUDIO_MP3",{enumerable:!0,get:function(){return c.AUDIO_MP3}}),Object.defineProperty(t,"AUDIO_MP4",{enumerable:!0,get:function(){return c.AUDIO_MP4}}),Object.defineProperty(t,"AUDIO_MPEG3",{enumerable:!0,get:function(){return c.AUDIO_MPEG3}}),Object.defineProperty(t,"AUDIO_MPEG",{enumerable:!0,get:function(){return c.AUDIO_MPEG}}),Object.defineProperty(t,"AUDIO_OGG",{enumerable:!0,get:function(){return c.AUDIO_OGG}}),Object.defineProperty(t,"AUDIO_OPUS",{enumerable:!0,get:function(){return c.AUDIO_OPUS}}),Object.defineProperty(t,"AUDIO_VORBIS",{enumerable:!0,get:function(){return c.AUDIO_VORBIS}}),Object.defineProperty(t,"IMAGE_BMP",{enumerable:!0,get:function(){return c.IMAGE_BMP}}),Object.defineProperty(t,"IMAGE_GIG",{enumerable:!0,get:function(){return c.IMAGE_GIG}}),Object.defineProperty(t,"IMAGE_HEIC_SEQUENCE",{enumerable:!0,get:function(){return c.IMAGE_HEIC_SEQUENCE}}),Object.defineProperty(t,"IMAGE_HEIC",{enumerable:!0,get:function(){return c.IMAGE_HEIC}}),Object.defineProperty(t,"IMAGE_HEIF_SEQUENCE",{enumerable:!0,get:function(){return c.IMAGE_HEIF_SEQUENCE}}),Object.defineProperty(t,"IMAGE_HEIF",{enumerable:!0,get:function(){return c.IMAGE_HEIF}}),Object.defineProperty(t,"IMAGE_JPEG",{enumerable:!0,get:function(){return c.IMAGE_JPEG}}),Object.defineProperty(t,"IMAGE_PNG",{enumerable:!0,get:function(){return c.IMAGE_PNG}}),Object.defineProperty(t,"IMAGE_TIFF",{enumerable:!0,get:function(){return c.IMAGE_TIFF}}),Object.defineProperty(t,"MULTIPART_MIXED",{enumerable:!0,get:function(){return c.MULTIPART_MIXED}}),Object.defineProperty(t,"TEXT_CSS",{enumerable:!0,get:function(){return c.TEXT_CSS}}),Object.defineProperty(t,"TEXT_CSV",{enumerable:!0,get:function(){return c.TEXT_CSV}}),Object.defineProperty(t,"TEXT_HTML",{enumerable:!0,get:function(){return c.TEXT_HTML}}),Object.defineProperty(t,"TEXT_PLAIN",{enumerable:!0,get:function(){return c.TEXT_PLAIN}}),Object.defineProperty(t,"TEXT_XML",{enumerable:!0,get:function(){return c.TEXT_XML}}),Object.defineProperty(t,"VIDEO_H264",{enumerable:!0,get:function(){return c.VIDEO_H264}}),Object.defineProperty(t,"VIDEO_H265",{enumerable:!0,get:function(){return c.VIDEO_H265}}),Object.defineProperty(t,"VIDEO_VP8",{enumerable:!0,get:function(){return c.VIDEO_VP8}}),Object.defineProperty(t,"APPLICATION_HESSIAN",{enumerable:!0,get:function(){return c.APPLICATION_HESSIAN}}),Object.defineProperty(t,"APPLICATION_JAVA_OBJECT",{enumerable:!0,get:function(){return c.APPLICATION_JAVA_OBJECT}}),Object.defineProperty(t,"APPLICATION_CLOUDEVENTS_JSON",{enumerable:!0,get:function(){return c.APPLICATION_CLOUDEVENTS_JSON}}),Object.defineProperty(t,"MESSAGE_RSOCKET_TRACING_ZIPKIN",{enumerable:!0,get:function(){return c.MESSAGE_RSOCKET_TRACING_ZIPKIN}}),Object.defineProperty(t,"MESSAGE_RSOCKET_ROUTING",{enumerable:!0,get:function(){return c.MESSAGE_RSOCKET_ROUTING}}),Object.defineProperty(t,"MESSAGE_RSOCKET_COMPOSITE_METADATA",{enumerable:!0,get:function(){return c.MESSAGE_RSOCKET_COMPOSITE_METADATA}});var l=r(145);Object.defineProperty(t,"CompositeMetadata",{enumerable:!0,get:function(){return l.CompositeMetadata}}),Object.defineProperty(t,"ReservedMimeTypeEntry",{enumerable:!0,get:function(){return l.ReservedMimeTypeEntry}}),Object.defineProperty(t,"WellKnownMimeTypeEntry",{enumerable:!0,get:function(){return l.WellKnownMimeTypeEntry}}),Object.defineProperty(t,"ExplicitMimeTimeEntry",{enumerable:!0,get:function(){return l.ExplicitMimeTimeEntry}}),Object.defineProperty(t,"encodeAndAddCustomMetadata",{enumerable:!0,get:function(){return l.encodeAndAddCustomMetadata}}),Object.defineProperty(t,"encodeAndAddWellKnownMetadata",{enumerable:!0,get:function(){return l.encodeAndAddWellKnownMetadata}});var d=_(r(694)),f=_(r(268)),E=_(r(986)),h=_(c);function _(e){return e&&e.__esModule?e:{default:e}}t.RSocketClient=d.default,t.RSocketServer=f.default,t.RSocketResumableTransport=E.default,t.WellKnownMimeType=h.default},46:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(758)),s=u(r(688)),i=u(r(759)),o=u(r(620)),a=u(r(139));function u(e){return e&&e.__esModule?e:{default:e}}class c{static just(...e){return new c((t=>{let r=!1,n=0;t.onSubscribe({cancel:()=>{r=!0},request:s=>{for(;!r&&s>0&&n<e.length;)t.onNext(e[n++]),s--;r||n!=e.length||t.onComplete()}})}))}static error(e){return new c((t=>{t.onSubscribe({cancel:()=>{},request:()=>{t.onError(e)}})}))}static never(){return new c((e=>{e.onSubscribe({cancel:a.default,request:a.default})}))}constructor(e,t=Number.MAX_SAFE_INTEGER){this._max=t,this._source=e}subscribe(e){let t;t="function"==typeof e?this._wrapCallback(e):e;const r=new l(t,this._max);this._source(r)}lift(e){return new c((t=>this._source(e(t))))}map(e){return this.lift((t=>new n.default(t,e)))}take(e){return this.lift((t=>new s.default(t,e)))}_wrapCallback(e){const t=this._max;return{onNext:e,onSubscribe(e){e.request(t)}}}}t.default=c;class l{constructor(e,t){this._cancel=()=>{this._active&&(this._active=!1,this._subscription&&this._subscription.cancel())},this._request=e=>{(0,i.default)(Number.isInteger(e)&&e>=1&&e<=this._max,"Flowable: Expected request value to be an integer with a value greater than 0 and less than or equal to %s, got `%s`.",this._max,e),this._active&&(e===this._max?this._pending=this._max:(this._pending+=e,this._pending>=this._max&&(this._pending=this._max)),this._subscription&&this._subscription.request(e))},this._active=!1,this._max=t,this._pending=0,this._started=!1,this._subscriber=e||{},this._subscription=null}onComplete(){if(this._active){this._active=!1,this._started=!0;try{this._subscriber.onComplete&&this._subscriber.onComplete()}catch(e){this._subscriber.onError&&this._subscriber.onError(e)}}else(0,o.default)(!1,"Flowable: Invalid call to onComplete(): %s.",this._started?"onComplete/onError was already called":"onSubscribe has not been called")}onError(e){!this._started||this._active?(this._active=!1,this._started=!0,this._subscriber.onError&&this._subscriber.onError(e)):(0,o.default)(!1,"Flowable: Invalid call to onError(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called")}onNext(e){if(this._active)if(0!==this._pending){this._pending!==this._max&&this._pending--;try{this._subscriber.onNext&&this._subscriber.onNext(e)}catch(e){this._subscription&&this._subscription.cancel(),this.onError(e)}}else(0,o.default)(!1,"Flowable: Invalid call to onNext(), all request()ed values have been published.");else(0,o.default)(!1,"Flowable: Invalid call to onNext(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called")}onSubscribe(e){if(this._started)(0,o.default)(!1,"Flowable: Invalid call to onSubscribe(): already called.");else{this._active=!0,this._started=!0,this._subscription=e;try{this._subscriber.onSubscribe&&this._subscriber.onSubscribe({cancel:this._cancel,request:this._request})}catch(e){this.onError(e)}}}}},758:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=(n=r(45))&&n.__esModule?n:{default:n};t.default=class{constructor(e,t){this._fn=t,this._subscriber=e,this._subscription=null}onComplete(){this._subscriber.onComplete()}onError(e){this._subscriber.onError(e)}onNext(e){try{this._subscriber.onNext(this._fn(e))}catch(e){(0,s.default)(this._subscription).cancel(),this._subscriber.onError(e)}}onSubscribe(e){this._subscription=e,this._subscriber.onSubscribe(e)}}},827:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=(n=r(620))&&n.__esModule?n:{default:n};t.default=class{constructor(e,t){this._source=e,this._transformer=t,this._done=!1,this._mappers=[]}onSubscribe(e){this._subscription=e}onNext(e){if(!this._sink)return void(0,s.default)("Warning, premature onNext for processor, dropping value");let t=e;this._transformer&&(t=this._transformer(e));const r=this._mappers.reduce(((e,t)=>t(e)),t);this._sink.onNext(r)}onError(e){this._error=e,this._sink?this._sink.onError(e):(0,s.default)("Warning, premature onError for processor, marking complete/errored")}onComplete(){this._done=!0,this._sink?this._sink.onComplete():(0,s.default)("Warning, premature onError for processor, marking complete")}subscribe(e){this._source.subscribe&&this._source.subscribe(this),this._sink=e,this._sink.onSubscribe(this),this._error?this._sink.onError(this._error):this._done&&this._sink.onComplete()}map(e){return this._mappers.push(e),this}request(e){this._subscription&&this._subscription.request(e)}cancel(){this._subscription&&this._subscription.cancel()}}},688:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=(n=r(45))&&n.__esModule?n:{default:n};t.default=class{constructor(e,t){this._subscriber=e,this._subscription=null,this._toTake=t}onComplete(){this._subscriber.onComplete()}onError(e){this._subscriber.onError(e)}onNext(e){try{this._subscriber.onNext(e),0==--this._toTake&&this._cancelAndComplete()}catch(e){(0,s.default)(this._subscription).cancel(),this._subscriber.onError(e)}}onSubscribe(e){this._subscription=e,this._subscriber.onSubscribe(e),this._toTake<=0&&this._cancelAndComplete()}_cancelAndComplete(){(0,s.default)(this._subscription).cancel(),this._subscriber.onComplete()}}},727:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.every=function(e){return new s.default((t=>{let r=null,n=0;t.onSubscribe({cancel:()=>{null!=r&&(clearInterval(r),r=null)},request:s=>{s<Number.MAX_SAFE_INTEGER?n+=s:n=Number.MAX_SAFE_INTEGER,null==r&&(r=setInterval((()=>{n>0&&(n!==Number.MAX_SAFE_INTEGER&&n--,t.onNext(Date.now()))}),e))}})}))};var n,s=(n=r(46))&&n.__esModule?n:{default:n}},941:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(620)),s=i(r(139));function i(e){return e&&e.__esModule?e:{default:e}}class o{static of(e){return new o((t=>{t.onSubscribe(),t.onComplete(e)}))}static error(e){return new o((t=>{t.onSubscribe(),t.onError(e)}))}constructor(e){this._source=e}subscribe(e){const t=new a(e);try{this._source(t)}catch(e){t.onError(e)}}flatMap(e){return new o((t=>{let r;const n=()=>{r&&r(),r=null};this._source({onComplete:n=>{e(n).subscribe({onComplete:e=>{t.onComplete(e)},onError:e=>t.onError(e),onSubscribe:e=>{r=e}})},onError:e=>t.onError(e),onSubscribe:e=>{r=e,t.onSubscribe(n)}})}))}map(e){return new o((t=>this._source({onComplete:r=>t.onComplete(e(r)),onError:e=>t.onError(e),onSubscribe:e=>t.onSubscribe(e)})))}then(e,t){this.subscribe({onComplete:e||s.default,onError:t||s.default})}}t.default=o;class a{constructor(e){this._active=!1,this._started=!1,this._subscriber=e||{}}onComplete(e){if(this._active){this._active=!1,this._started=!0;try{this._subscriber.onComplete&&this._subscriber.onComplete(e)}catch(e){this._subscriber.onError&&this._subscriber.onError(e)}}else(0,n.default)(!1,"Single: Invalid call to onComplete(): %s.",this._started?"onComplete/onError was already called":"onSubscribe has not been called")}onError(e){!this._started||this._active?(this._active=!1,this._started=!0,this._subscriber.onError&&this._subscriber.onError(e)):(0,n.default)(!1,"Single: Invalid call to onError(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called")}onSubscribe(e){if(this._started)(0,n.default)(!1,"Single: Invalid call to onSubscribe(): already called.");else{this._active=!0,this._started=!0;try{this._subscriber.onSubscribe&&this._subscriber.onSubscribe((()=>{this._active&&(this._active=!1,e&&e())}))}catch(e){this.onError(e)}}}}},956:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.every=t.Single=t.FlowableProcessor=t.Flowable=void 0;var n=a(r(46)),s=a(r(941)),i=a(r(827)),o=r(727);function a(e){return e&&e.__esModule?e:{default:e}}t.Flowable=n.default,t.FlowableProcessor=i.default,t.Single=s.default,t.every=o.every},628:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECTION_STATUS={CLOSED:Object.freeze({kind:"CLOSED"}),CONNECTED:Object.freeze({kind:"CONNECTED"}),CONNECTING:Object.freeze({kind:"CONNECTING"}),NOT_CONNECTED:Object.freeze({kind:"NOT_CONNECTED"})}},717:()=>{},833:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(628);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var s=r(717);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}))},722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=(n=r(759))&&n.__esModule?n:{default:n},i=r(956),o=r(269),a=r(833);t.default=class{constructor(e,t){this._handleClosed=e=>{this._close(new Error(e.reason||"RSocketWebSocketClient: Socket closed unexpectedly."))},this._handleError=e=>{this._close(e.error)},this._handleOpened=()=>{this._setConnectionStatus(a.CONNECTION_STATUS.CONNECTED)},this._handleMessage=e=>{try{const t=this._readFrame(e);this._receivers.forEach((e=>e.onNext(t)))}catch(e){this._close(e)}},this._encoders=t,this._options=e,this._receivers=new Set,this._senders=new Set,this._socket=null,this._status=a.CONNECTION_STATUS.NOT_CONNECTED,this._statusSubscribers=new Set}close(){this._close()}connect(){(0,s.default)("NOT_CONNECTED"===this._status.kind,"RSocketWebSocketClient: Cannot connect(), a connection is already established."),this._setConnectionStatus(a.CONNECTION_STATUS.CONNECTING);const e=this._options.wsCreator,t=this._options.url;this._socket=e?e(t):new WebSocket(t);const r=this._socket;r.binaryType="arraybuffer",r.addEventListener("close",this._handleClosed),r.addEventListener("error",this._handleError),r.addEventListener("open",this._handleOpened),r.addEventListener("message",this._handleMessage)}connectionStatus(){return new i.Flowable((e=>{e.onSubscribe({cancel:()=>{this._statusSubscribers.delete(e)},request:()=>{this._statusSubscribers.add(e),e.onNext(this._status)}})}))}receive(){return new i.Flowable((e=>{e.onSubscribe({cancel:()=>{this._receivers.delete(e)},request:()=>{this._receivers.add(e)}})}))}sendOne(e){this._writeFrame(e)}send(e){let t;e.subscribe({onComplete:()=>{t&&this._senders.delete(t)},onError:e=>{t&&this._senders.delete(t),this._close(e)},onNext:e=>this._writeFrame(e),onSubscribe:e=>{t=e,this._senders.add(t),t.request(Number.MAX_SAFE_INTEGER)}})}_close(e){if("CLOSED"===this._status.kind||"ERROR"===this._status.kind)return;const t=e?{error:e,kind:"ERROR"}:a.CONNECTION_STATUS.CLOSED;this._setConnectionStatus(t),this._receivers.forEach((t=>{e?t.onError(e):t.onComplete()})),this._receivers.clear(),this._senders.forEach((e=>e.cancel())),this._senders.clear();const r=this._socket;r&&(r.removeEventListener("close",this._handleClosed),r.removeEventListener("error",this._handleClosed),r.removeEventListener("open",this._handleOpened),r.removeEventListener("message",this._handleMessage),r.close(),this._socket=null)}_setConnectionStatus(e){this._status=e,this._statusSubscribers.forEach((t=>t.onNext(e)))}_readFrame(e){const t=(0,o.toBuffer)(e.data);return this._options.lengthPrefixedFrames?(0,o.deserializeFrameWithLength)(t,this._encoders):(0,o.deserializeFrame)(t,this._encoders)}_writeFrame(e){try{const t=this._options.lengthPrefixedFrames?(0,o.serializeFrameWithLength)(e,this._encoders):(0,o.serializeFrame)(e,this._encoders);(0,s.default)(this._socket,"RSocketWebSocketClient: Cannot send frame, not connected."),this._socket.send(t)}catch(e){this._close(e)}}}},876:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=(n=r(722))&&n.__esModule?n:{default:n};t.default=s.default},262:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(269),s=r(956),i=r(876),o=r(114);let a,u;Math.floor(1e4*Math.random()+1);const c=new o.EventLog;function l(){c.add("connection: click"),function(){let e=document.getElementById("tokenJWT").value,t=document.getElementById("host").value,r=document.getElementById("routeSetup").value,s=document.getElementById("messageSetup").value,o=document.getElementById("dataMimeTypeText").checked?"text/plain":"application/json";a=new n.RSocketClient({setup:{payload:{data:Buffer.from(s),metadata:n.encodeAndAddWellKnownMetadata(n.encodeAndAddCustomMetadata(Buffer.alloc(0),"message/x.rsocket.authentication.bearer.v0",Buffer.from(e)),n.MESSAGE_RSOCKET_ROUTING,Buffer.from(String.fromCharCode(r.length)+r))},keepAlive:6e4,lifetime:7e4,dataMimeType:o,metadataMimeType:n.MESSAGE_RSOCKET_COMPOSITE_METADATA.string},transport:new i.default({url:t},n.BufferEncoders),errorHandler:e=>c.add("rsocket client error: "+e.message)})}(),a.connect().subscribe({onComplete:e=>{c.add("connection: on complete"),u=e,e.connectionStatus().subscribe((e=>{"ERROR"==e.kind?c.add("connection status: status "+e.kind+" error: "+e.error):c.add("connection status: status "+e.kind),function(e){"CONNECTED"==e.kind?(document.getElementById("connect").disabled=!0,document.getElementById("disconnect").disabled=!1,document.getElementById("sendFireAndForget").disabled=!1,document.getElementById("sendRequestResponse").disabled=!1,document.getElementById("sendRequestStream").disabled=!1,document.getElementById("sendRequestChannel").disabled=!1):(document.getElementById("connect").disabled=!1,document.getElementById("disconnect").disabled=!0,document.getElementById("sendFireAndForget").disabled=!0,document.getElementById("sendRequestResponse").disabled=!0,document.getElementById("sendRequestStream").disabled=!0,document.getElementById("sendRequestChannel").disabled=!0)}(e)}))},onError:e=>{c.add("connection: error "+e)},onSubscribe:e=>{c.add("connection: on subscribe")}})}document.getElementById("connect").addEventListener("click",(e=>l())),document.getElementById("disconnect").addEventListener("click",(e=>(c.add("disconnect: click"),void a.close()))),document.getElementById("sendFireAndForget").addEventListener("click",(e=>function(){let e=document.getElementById("messageFireAndForget").value,t=document.getElementById("routeFireAndForget").value;u.fireAndForget({data:Buffer.from(e),metadata:n.encodeAndAddWellKnownMetadata(Buffer.alloc(0),n.MESSAGE_RSOCKET_ROUTING,Buffer.from(String.fromCharCode(t.length)+t))})}())),document.getElementById("sendRequestResponse").addEventListener("click",(e=>function(){let e=document.getElementById("messageRequestResponse").value,t=document.getElementById("routeRequestResponse").value;u.requestResponse({data:Buffer.from(e),metadata:n.encodeAndAddWellKnownMetadata(Buffer.alloc(0),n.MESSAGE_RSOCKET_ROUTING,Buffer.from(String.fromCharCode(t.length)+t))}).subscribe({onComplete:e=>{c.add("request: on complete data: "+e.data+", metadata: "+e.metadata)},onError:e=>{c.add("request: error "+e)},onSubscribe:e=>{c.add("request: on subscribe")}})}())),document.getElementById("sendRequestStream").addEventListener("click",(e=>function(){let e=document.getElementById("messageRequestStream").value,t=document.getElementById("routeRequestStream").value;u.requestStream({data:Buffer.from(e),metadata:n.encodeAndAddWellKnownMetadata(Buffer.alloc(0),n.MESSAGE_RSOCKET_ROUTING,Buffer.from(String.fromCharCode(t.length)+t))}).subscribe({onComplete:()=>{c.add("request: on complete")},onError:e=>{c.add("request: error "+e)},onNext:e=>{c.add("request: on next data: "+e.data+", metadata: "+e.metadata)},onSubscribe:e=>{e.request(1e3),c.add("request: on subscribe")}})}())),document.getElementById("sendRequestChannel").addEventListener("click",(e=>function(){let e=document.getElementById("messageRequestChannel").value,t=document.getElementById("routeRequestChannel").value,r=e.split(",").map((e=>({data:Buffer.from(e),metadata:n.encodeAndAddWellKnownMetadata(Buffer.alloc(0),n.MESSAGE_RSOCKET_ROUTING,Buffer.from(String.fromCharCode(t.length)+t))})));u.requestChannel(s.Flowable.just(...r)).subscribe({onComplete:()=>{c.add("request: on complete")},onError:e=>{c.add("request: error "+e)},onNext:e=>{c.add("request: on next data: "+e.data+", metadata: "+e.metadata)},onSubscribe:e=>{e.request(1e3),c.add("request: on subscribe")}})}())),document.getElementById("clearEventLog").addEventListener("click",(e=>{document.getElementById("eventLog").innerHTML=""}))},114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventLog=void 0,t.EventLog=class{add(e){var t=document.getElementById("eventLog"),r=document.createElement("li");r.appendChild(document.createTextNode(e)),t.appendChild(r)}}}},t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.g.Buffer=r.g.Buffer||r(764).lW,Promise.resolve().then((()=>r(262)))})();